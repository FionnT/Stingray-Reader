
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Implementation &#8212; Stingray-Reader 5.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="History" href="../history.html" />
    <link rel="prev" title="Data Conversion – ETL with Validation" href="../demo/conversion.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="implementation">
<span id="id1"></span><h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h1>
<p class="plantuml">
<img src="../_images/plantuml-ba909cf05c301b989c24d7b44d291727ab06a0ed.png" alt="&#64;startuml
package stingray-reader {
    package schema_instance
    package estruct
    package cobol_parser
    package workbook
    package implementations

    implementations ..&gt; workbook
    workbook ..&gt; cobol_parser
    workbook ..&gt; estruct
    workbook ..&gt; schema_instance
    schema_instance ..&gt; estruct
}
&#64;enduml"/>
</p>
<p>We’ll look at each module, separately.</p>
<section id="module-stingray.schema_instance">
<span id="schema-and-instance"></span><h2>Schema and Instance<a class="headerlink" href="#module-stingray.schema_instance" title="Permalink to this headline">¶</a></h2>
<section id="schema-and-navigation-models">
<h3>Schema and Navigation models.<a class="headerlink" href="#schema-and-navigation-models" title="Permalink to this headline">¶</a></h3>
<p>A number of file formats require a schema to unpack (or decode) the data. Even a simple CSV file offers headings in
the first row as a kind of schema. Each row can be interpreted as a dictionary where the headers are keys.</p>
<p>The JSON Schema permits definition of a schema that can be used to navigate spreadsheet files, like CSV. It can be
used to unpack more sophisticated generic structures in JSON, YAML, and TOML format, as well as XML.</p>
<p>It can also be used to unpack COBOL files, in Unicode or ASCII text as well as EBCDIC. Most of the features of a
COBOL DDE definition parallel JSON Schema constructs.</p>
<ul class="simple">
<li><p>COBOL has Atomic fields of type text (with vaious format details), and a variety of “Computational” variants. The
most important is <cite>COMP-3</cite>, which is a decimal representation with digits packed two per byte. THe JSON Schema
presumes types “null”, “boolean”, “number”, or “string” types have text representations that fit well with COBOL.</p></li>
<li><p>The hierarchy of COBOL DDE’s is the JSON Schema “object” type.</p></li>
<li><p>The COBOL <cite>OCCURS</cite> clause is the JSON Schema “array” type. The simple case, with a single, literal <cite>TIMES</cite> option
is expressed with <cite>maxItems</cite> and <cite>minItems</cite>.</p></li>
</ul>
<p>While COBOL is more sophisticated than CSV, it’s generally comprarable to JSON/YAML/TOML/XML. There are some unique
specializations related to COBOL processing.</p>
<section id="cobol-processing">
<h4>COBOL Processing<a class="headerlink" href="#cobol-processing" title="Permalink to this headline">¶</a></h4>
<p>The parallels between COBOL and JSON Schema suggest that COBOL Data Definition Entries (DDE’s) can be translated to
JSON Schema constructs. The JSON Schema (with extensions) can be used to decode bytes from COBOL representation to
create native Python objects. There are three areas: handling <cite>REDEFINES</cite>,  <cite>OCCURS DEPENDING ON</cite> structures,
and EBCDIC unpacking.</p>
<section id="redefines">
<h5>Redefines<a class="headerlink" href="#redefines" title="Permalink to this headline">¶</a></h5>
<p>A COBOL <cite>REDEFINES</cite> clause defines a free union of types for a given sequence of bytes. Within the application code,
there are generally fields that imply a more useful tagged union. The tags used for discrimination is not part of the
COBOL definition.</p>
<p>To make this work, each field within the JSON schema has an implied starting offset and length.
A COBOL <cite>REDEFINES</cite> clause can be described with a JSON Schema extension that includes a JSON Pointer to name a field with which a given field is co-located.</p>
<p>The COBOL language requires a strict backwards reference to a previously-defined field, and the names must have the
name indentation level, making them peers within the same parent, reducing the need for complex pointers.</p>
</section>
<section id="occurs-depending-on">
<h5>Occurs Depending On<a class="headerlink" href="#occurs-depending-on" title="Permalink to this headline">¶</a></h5>
<p>The complexity of <cite>OCCURS DEPENDING ON</cite> constructs arises because the size (<cite>maxItems</cite>) of the array is the value of
another field in the COBOL record definition.</p>
<p>Ideally, a JSON Reference names the referenced field as the <cite>maxItems</cite> attribute for an array. This, however,
is not supported, so an extension vocabulary is required.</p>
</section>
<section id="ebcdic-unpacking">
<h5>EBCDIC Unpacking<a class="headerlink" href="#ebcdic-unpacking" title="Permalink to this headline">¶</a></h5>
<p>There are a number of distinctive data types used by COBOL and represented in EBCDIC. The most notable of these is
the packed decimal representation of numbers. Each byte has two decimal digits. The final byte as a digit and sign
information in the lower four bits.</p>
<p>Further, COBOL records have a “RECFM” wrapper that may include bytes to describe the record’s physical length.</p>
</section>
<section id="notes">
<h5>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h5>
<p>See <a class="reference external" href="https://json-schema.org/draft/2020-12/relative-json-pointer.html#RFC6901">https://json-schema.org/draft/2020-12/relative-json-pointer.html#RFC6901</a> for information on JSON Pointers.</p>
</section>
<section id="terminology">
<h5>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h5>
<p>The JSON Schema specification talks about the data described by the schema as a “instance” of the schema. The schema
is essentially a class of object, the data is an instance of that class.</p>
<p>It’s awkward to distinguish the more general use of “instance” from the specific use of “Instance of a JSON Schema”.
We’ll try to use <cite>Instance</cite>, and <cite>NDInstance</cite> to talk about the object described by a JSON Schema.</p>
</section>
</section>
<section id="goals">
<h4>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h4>
<p>Stingray Reader must support Delimited Files (JSON, YAML, TOML, and XML) as well as Non-Delimited Files, typified by COBOL. Other non-delimited formats should be describable. Additionally, workbook formats like XLSX, ODS, Numbers, and CSV should be handled properly.</p>
<p>The JSON Schema can be used to provide validation of an instance. It can also be used to unpack the instance. In the case of COBOL, the unpacking must be done lazily to properly handle <cite>REDEFINES</cite> and <cite>OCCURS DEPENDING ON</cite>.</p>
<section id="delimited-files">
<h5>Delimited Files<a class="headerlink" href="#delimited-files" title="Permalink to this headline">¶</a></h5>
<p>Delimited files have text representations with syntax defined by a module like <cite>json</cite>. Because of the presence of delimiters, individual character and byte counting isn’t relevant.</p>
<p>Pythonic navigation through instances of delimited structures leverages the physical format’s parser output. Since most formats provide a mixture of dictionaries and lists, <cite>object[“field”]</cite> and <cite>object[index]</cite> work nicely.</p>
<p>The JSON Schema structure will parallel the instance structure.</p>
</section>
<section id="workbook-files">
<h5>Workbook Files<a class="headerlink" href="#workbook-files" title="Permalink to this headline">¶</a></h5>
<p>Files may also be complex binary objects described by workbook file for XLSX, ODS, Numbers, or CSV files. To an extent, these are somewhat like delimited files, since individual character and byte counting isn’t relevant.</p>
<p>Pythonic navigation through instances of workbook row structures leverages the workbook format’s parser output. Most workbooks are lists of cells; a schema with a flat list of properties will work nicely.</p>
<p>The <cite>csv</cite> fornmat is built-in. It’s more like a workbook than it is like JSON or TPOML. For example, with simple CSV files, the JSON Schema must be a flat list of properties corresponding to the columns.</p>
</section>
<section id="non-delimited-files-cobol">
<h5>Non-Delimited Files (COBOL)<a class="headerlink" href="#non-delimited-files-cobol" title="Permalink to this headline">¶</a></h5>
<p>It’s essential to provide Pythonic navigation through a COBOL structure. Because of <cite>REDEFINES</cite> clauses, the COBOL structure may not map directly to simple Pythonic dict and list types. Instead, the evaluation of each field must be strictly lazy.</p>
<p>This suggests several target constructs.</p>
<ul class="simple">
<li><p><cite>object.name(“field”).value()</cite> should catapult down through the instance to the named field. Syntactic sugar might include <cite>object[“field”]</cite> or <cite>object.field</cite>. Note that COBOL raises a compile-time error for a reference to an amiguous name; names may be duplicated, but the duplicates must be disambiguated with <cite>OF</cite> clauses.</p></li>
<li><p><cite>object.name(“field”).index(x).value()</cite> works when the field is a member of an array somewhere above it in the structure. Syntactic sugar might include <cite>object[“field”][x]</cite> or <cite>object.field[x]</cite>.</p></li>
</ul>
<p>These constructs are abbreviations for explicit field-by-field navigation. The field-by-field navigation involves explicitly naming all parent fields. Here are some constructs.</p>
<ul class="simple">
<li><p><cite>object.name(“parent”).name(“child”).name(“field”).value()</cite> is the full navigation path to a nested field. This can be <cite>object[“parent”][“child”][“field”]</cite>. A more sophisticated parser for URL path syntax might also be supported. <cite>object.name[“parent/child/field”]</cite>.</p></li>
<li><p><cite>object.name(“parent”).name(“child”).index(x).name(“field”).value()</cite> is the full navigation path to a nesteed field with a parent occurs-depending-on clause. This can be <cite>object[“parent”][“child”][x][“field”]</cite>. A more sophisticated parser for URL path syntax might also be supported. <cite>object.name[“parent/child/0/field”]</cite>.</p></li>
</ul>
<p>The COBOL <cite>OF</cite> construct provides parentage in reverse order. This means <cite>object.name(“field”).of(“child”).of(“parent”).value()</cite> is requred to parallel COBOL syntax. While unpleasant, it’s helpful to support this.</p>
<p>The <cite>value()</cite> method can be helpful to be explicit about locating a value. This avoids eager evaluation of <cite>REDEFINES</cite> alternatives that happen to be invalid.</p>
<p>An alternative to the <cite>value()</cite> method is to use built-in special names <cite>__int__()</cite>, <cite>__float__()</cite>, <cite>__str__()</cite>, <cite>__bool__()</cite> to do conversion to a primitive type; i.e., <cite>int(object.name[“parent/child/field”])</cite>. Additional functions like <cite>asdict()</cite>, <cite>aslist()</cite>, and <cite>asdecimal()</cite> can be provided to handle conversion edge cases.</p>
<p>We show these as multi-step operations with a fluent interface. This works out well when a nagivation context object is associated with each sequence of <cite>object.name()…</cite>, <cite>object.index()</cite>, and <cite>object.of()</cite> operations. The first call in the sequence emits a navigation object; all subsequent steps in the fluent interface return navigation objects. The final <cite>value()</cite> or other special method refers back to the original instance container for type conversion of an atomic field.</p>
<p>Each COBOL navigation step involves two parallel operations:</p>
<ul class="simple">
<li><p>Finding the definition of the named subschema within a JSON schema.</p></li>
<li><p>Locating the sub-instance for the item. This is a slice of the instance.</p></li>
</ul>
<p>The instance is a buffer of bytes (or characters for non-COBOL file processing.) The overall COBOL record has a starting offset of zero. Each DDE has an starting offset and length. For object property navigation this is the offset to the named property that describes the DDE. For array navigation, this is the index to a subinstance within an array of subinstances.</p>
<p>It’s common practice in COBOL to use a non-atomic field as if it was atomic. A date field, for example, may have year, month, and day subfields that are rarely used independently. This means that JSON Schema array and object definitions are implicitly <cite>type: “string”</cite> to parallel the way COBOL treats non-atomic fields as <cite>USAGE IS DISPLAY</cite>.</p>
</section>
</section>
<section id="formal-definitions-for-non-delimited-files">
<h4>Formal Definitions for Non-Delimited Files<a class="headerlink" href="#formal-definitions-for-non-delimited-files" title="Permalink to this headline">¶</a></h4>
<p>One approach to locating field values in a nested COBOL object with <cite>REDEFINES</cite> and <cite>OCCURS DEPENDING ON</cite> is to decorate the schema with instance location details for each item in the schema based on the current value of the instance.</p>
<p>This handles <cite>OCCURS DEPENDING ON</cite> by computing unique decorations for each instance.</p>
<p>We’ll describe this as being done eagerly. Pragmatically, it can be done lazily and cached. The <cite>REDEFINES</cite> is handled by application program logic to avoid references to invalid data.</p>
<p>The instance, <span class="math notranslate nohighlight">\(I\)</span>, is an array of <span class="math notranslate nohighlight">\(b\)</span> characters or bytes.</p>
<div class="math notranslate nohighlight">
\[I = \{ i_0, i_1, i_2, ..., i_{b-1} \}\]</div>
<p>We can slice <span class="math notranslate nohighlight">\(I\)</span> using start, <span class="math notranslate nohighlight">\(s\)</span>, and end, <span class="math notranslate nohighlight">\(e\)</span> locations to create sub-instances.</p>
<div class="math notranslate nohighlight">
\[I[s: e] = \{ i_x \mid s \leq x &lt; e \}\]</div>
<p>It seems like <span class="math notranslate nohighlight">\(I_{s:e}\)</span> might be slightly more traditional notation than <span class="math notranslate nohighlight">\(I[s:e]\)</span>. <span class="math notranslate nohighlight">\(I_{\{x \mid s \leq x &lt; e\}}\)</span> seems fussy.</p>
<p>We can follow the Python convention of omitting <span class="math notranslate nohighlight">\(s\)</span> when <span class="math notranslate nohighlight">\(s = 0\)</span> and omitting <span class="math notranslate nohighlight">\(e\)</span> when <span class="math notranslate nohighlight">\(e = b\)</span>. This means that <span class="math notranslate nohighlight">\(I \equiv I[:]\)</span>.</p>
<p>A Schema, <span class="math notranslate nohighlight">\(S\)</span>, is a static description of a number of instances, <span class="math notranslate nohighlight">\(I_0, I_1, I_2, ...\)</span>. We say the schema models an instance: <span class="math notranslate nohighlight">\(S \tilde \models I\)</span>. The modelling is approximate; the model is incomplete. A more complete model requires resolution of <code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code> to compute locations, <span class="math notranslate nohighlight">\(L\)</span>. This is <span class="math notranslate nohighlight">\(S \circ L \models I\)</span>.
The schema, <span class="math notranslate nohighlight">\(S\)</span>, composed with additional location information, <span class="math notranslate nohighlight">\(L\)</span>, models the instance, <span class="math notranslate nohighlight">\(I\)</span>.</p>
<p>A Schema has a structure with three kinds of elements:</p>
<ul class="simple">
<li><p>Atomic, with no further structure. This has a type conversion (or “unpack”) function, <span class="math notranslate nohighlight">\(t(I)\)</span>, to extract a value from an instance.
It requires a length, <span class="math notranslate nohighlight">\(l\)</span>, that defines a slice from the instance.
We can say <span class="math notranslate nohighlight">\(t_{S}(I[:l])\)</span> to refer to the type conversion function for a specific Schema, <span class="math notranslate nohighlight">\(S\)</span>, used to decode an instance, <span class="math notranslate nohighlight">\(I\)</span>.
JSON Schema defines types of number, int, string, boolean, and null. Other types may need to be added to handle COBOL data.</p></li>
<li><p>Array, with an Items subschema, <span class="math notranslate nohighlight">\(S_i\)</span> that describes a repeating sub-instance.
The number of sub instances, <span class="math notranslate nohighlight">\(r\)</span> may be provided explicitly.
In the <code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code> case, the value of <span class="math notranslate nohighlight">\(r\)</span> is the value of another field.
This means <span class="math notranslate nohighlight">\(r = t_{S_d}(I)\)</span> because the ocurrences depend on the value in field <span class="math notranslate nohighlight">\(S_d\)</span>.</p></li>
<li><p>Object, with Properties structure that describes a number of subschema, <span class="math notranslate nohighlight">\(S_{p_x}\)</span>.</p></li>
</ul>
<p>We can summarize these three definitions as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}S = \begin{cases}
    \langle t(I), l \rangle &amp;\text{if atomic} \\
    \langle S_i, r \rangle &amp;\text{if array} \\
    \{S_{p_0}, S_{p_1}, S_{p_2}, ...\} &amp;\text{if object}
\end{cases}\end{split}\]</div>
<p>The value of an instance, <span class="math notranslate nohighlight">\(I\)</span>, interpreted by given schema, <span class="math notranslate nohighlight">\(S\)</span>, is the type conversion function, <span class="math notranslate nohighlight">\(t_S(I)\)</span>, applied to a slice of the instance defined by the length, <span class="math notranslate nohighlight">\(l\)</span>, which is <span class="math notranslate nohighlight">\(I[:l_S]\)</span>.</p>
<div class="math notranslate nohighlight">
\[v = t_S(I[:l_S])\]</div>
<p>As suggested above, the <code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code> means the locations of sub-instances depend on  values elsewhere in the instance.</p>
<p>The starting location of a slice is computed for each schema item as follows:</p>
<ul class="simple">
<li><p>For an atomic item, it is the schema, <span class="math notranslate nohighlight">\(S\)</span>. The starting offset, <span class="math notranslate nohighlight">\(s\)</span>, is zero, and can be omitted, <span class="math notranslate nohighlight">\(I[s=0: l] \equiv I[:l]\)</span>.</p></li>
<li><p>For an array, each item within the array has its own start based on the index value, <span class="math notranslate nohighlight">\(x\)</span>, and the length of the item sub-schema, <span class="math notranslate nohighlight">\(S_i\)</span>. The start for a given index value, <span class="math notranslate nohighlight">\(s(x) = x \times l(S_i)\)</span>; <span class="math notranslate nohighlight">\(I[s: s+l] = I[x \times l(S_i): x \times l(S_i)+l(S_i)]\)</span>. The overall size of the array is <span class="math notranslate nohighlight">\(r \times l(S_i)\)</span>; note that <span class="math notranslate nohighlight">\(r\)</span> may be dependent on the value of another field.</p></li>
<li><p>For an object, each property begins after the previous property. <span class="math notranslate nohighlight">\(s(S_{p+1}) = s(S_{p}) + l(S_{p})\)</span>. This recurrence is a summation. <span class="math notranslate nohighlight">\(s(S_{p+1}) = \sum_{0 \leq i &lt; p+1}l(S_i)\)</span>.</p></li>
</ul>
<p>The length of a schema, <span class="math notranslate nohighlight">\(l(S)\)</span>, is the sum of the lengths of the items within the schema.</p>
<div class="math notranslate nohighlight">
\[\begin{split}l(S) = \begin{cases} l &amp;\text{if atomic} \\
                  l(S_i) \times r &amp;\text{if array} \\
                  \sum_{S_{p} \in S} l(S_{p}) &amp;\text{if object}
    \end{cases}\end{split}\]</div>
<p>This can be unrolled into a top-down, post-order traversal of the schema to create Location objects.</p>
</section>
<section id="json-schema-considerations">
<h4>JSON Schema Considerations<a class="headerlink" href="#json-schema-considerations" title="Permalink to this headline">¶</a></h4>
<p>JSON Schema is focused on delimited data where a parser has handled data type conversions.</p>
<p>We require some extensions or adaptations to cover issues that not handled well by JSON Schema.</p>
<ul class="simple">
<li><p>COBOL encoded data (Packed-Decimal, Binary, etc.) JSON Schema presumes delimited files with a parser’s conversions of data. We are driving the parser from the JSON Schema, and additional details are required.</p></li>
<li><p>Occurs Depending On reference. JSON Schema limits the <cite>maxItems</cite> to an unsigned integer. We need to <cite>$ref</cite>, and an extension vocabulary is required.</p></li>
<li><p>Workbook conversions of numeric data to durations or timestamps. This distinct from the <cite>format</cite> option on a <cite>“type”: “string”</cite> where the format provides a pattern for parsing text. We need to specify an additional conversion.</p></li>
</ul>
<p>See <a class="reference external" href="https://github.com/json-schema-org/json-schema-spec">https://github.com/json-schema-org/json-schema-spec</a> for the meta schema used to define a schema.</p>
<p>We have two overall strategies: Update the meta schema or adapt to the existing meta schema.</p>
<section id="update-the-meta-schema">
<h5>Update the meta schema<a class="headerlink" href="#update-the-meta-schema" title="Permalink to this headline">¶</a></h5>
<p>We could make some changes to the JSON Schema meta schema through a vocabulary addition.</p>
<ul class="simple">
<li><p>Add a new <cite>decimal</cite> type to the validation vocabulary.</p></li>
<li><p>Permit a <cite>$ref</cite> validation for <cite>“maxItems”</cite> in the array vocabulary.</p></li>
<li><p>Additional unpacking details for “integer” and “number” are needed. Currently “format” is used for strings. We could expand it’s use to include encoding details for numbers. This would support bigendian integers, bigendian floats, packed decimal, and zoned decimal number, integer, and decimal values.</p></li>
<li><p>Additional conversion details for Workbook numbers that are encodings of durations or timestamps.</p></li>
</ul>
<p>We can then use a revised meta schema to validate the schema used for Workbooks or COBOL.</p>
</section>
<section id="adapt-to-the-existing-meta-schema">
<h5>Adapt to the existing meta schema<a class="headerlink" href="#adapt-to-the-existing-meta-schema" title="Permalink to this headline">¶</a></h5>
<p>We could adapt to the existing JSON Schema meta schema.</p>
<p>We <em>can</em> consider COBOL encoded numeric values as <cite>“type”: “string”</cite> with additional <cite>“contentEncoding”</cite> details. Calling these values strings seems to push the envelope a bit: JSON Schema generally avoies syntax and unpacking issues. The value truly is a number.</p>
<p>It seems improper to require a separate type conversion to create the needed, Python-specific <cite>Decimal</cite>.  A conversion can be <em>implicit</em>, using the “cobol” keyword value. Or, it can be <em>explicit</em>, using a new “conversion” keyword for extended types like timestamp, duration based on float, and <cite>Decimal</cite> based unpacking bytes.</p>
<p>This is the approach taken for Workbook values like durations and timestamps. A supplemental <cite>“format”: “duration”</cite> is used to parse a string that encodes a duration value. Parsers, generally, don’t do anything with this. Validation can be handled to conform the string matches the format. Decoding a useful object is left to the application.</p>
<p>The <cite>“contentEncoding”</cite> provides a way to describe COBOL Packed Decimal and Binary as strings of bytes. A <cite>“cobol”</cite> keyword gets Usage and Picture values required to decode EBCDIC.</p>
<p>Here’s an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
 <span class="s2">&quot;contentEncoding&quot;</span><span class="p">:</span> <span class="s2">&quot;packed-decimal&quot;</span><span class="p">,</span>
 <span class="s2">&quot;cobol&quot;</span><span class="p">:</span> <span class="s2">&quot;05 SOME-FIELD USAGE COMP-3 PIC S999V99&quot;</span><span class="p">,</span>
 <span class="s2">&quot;conversion&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Other <cite>“contentEncoding”</cite> values include “bigendian-h”,  “bigendian-i”, “bigendian-q” (for short, int, and long long values.) Also, “bigendian-float” and “bigendian-double”. And, of course, “CP037” or “EBCDIC” to decode ordinary strings from EBCDIC to native text.</p>
<p>This permits a little more flexibility for moving to native (non-EBCDIC) file formats. Instead of the “cobol” keyword to propvide unpackong details, we can use a “struct” keyword to provide Python’s “struct” module format codes.</p>
<p>Also, we need to add “maxItemsDependsOn” keyword to include the “$ref” value for arrays. Here’s an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
 <span class="s2">&quot;maxItemsDependsOn&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/path/to/SIZE-FIELD&quot;</span><span class="p">},</span>
 <span class="s2">&quot;cobol&quot;</span><span class="p">:</span> <span class="s2">&quot;05 THINGS OCCURS DEPENDING ON SIZE-FIELD&quot;</span><span class="p">,</span>
 <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>For <cite>REDEFINES</cite>, we use the existing “oneOf”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;REDEFINES-A-B-C&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;oneOf&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">}}},</span>
        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">}}},</span>
        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span><span class="p">}}},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To provide COBOL-style naming to OneOf/REDEFINES schema, we impose a rule that each alternative must be an object, and each object must have at most one named property. The parent item is effectively anonymous, since it’s never used in COBOL.</p>
</section>
</section>
<section id="schema-design">
<h4>Schema Design<a class="headerlink" href="#schema-design" title="Permalink to this headline">¶</a></h4>
<p>Here is the extended JSON Schema definition.
This is a translation of the various JSON Schema constructs into Python class definitions.
These objects must be considered immutable. (Pragmatically, RefTo objects can be updated
to resolve forward references.)</p>
<p>A <a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code></a> is used to describe an <code class="xref py py-class docutils literal notranslate"><span class="pre">Instance</span></code>.
For non-delimited instances, the schema requires additional <a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><code class="xref py py-class docutils literal notranslate"><span class="pre">Location</span></code></a> information;
this must be computed lazily to permits <code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code> to work.
For delimited instances, no additional data is required, since the parser located all object
boundaries and did conversions to Python types. Similarly, for workbook instances, the
underlying workbook parser can create a row of Python objects.</p>
<p>The <cite>DependsOnArraySchema</cite> is an extension to handle references to another
field’s value to provide <code class="docutils literal notranslate"><span class="pre">minItems</span></code> and <code class="docutils literal notranslate"><span class="pre">maxItems</span></code> for an array.
This handles the COBOL <code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code>. This requires a reference to another
field which is a reference to another field instead of a simple value.</p>
<p>The COBOL <code class="docutils literal notranslate"><span class="pre">REDEFINES</span></code> clause is handled created a OneOf suite of alternatives
and using some JSON Schema “$ref” references to preserve the original, relatively flat
naming for an elements and the element(s) which redefine it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@startuml</span>
    <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Schema</span> <span class="p">{</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">string</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="nc">AtomicSchema</span>

    <span class="k">class</span> <span class="nc">ArraySchema</span>

    <span class="k">class</span> <span class="nc">DependsOnArraySchema</span>

    <span class="k">class</span> <span class="nc">ObjectSchema</span>

    <span class="k">class</span> <span class="nc">OneOfSchema</span>

    <span class="k">class</span> <span class="nc">RefToSchema</span>

    <span class="n">Schema</span> <span class="o">&lt;|--</span> <span class="n">AtomicSchema</span>
    <span class="n">Schema</span> <span class="o">&lt;|--</span> <span class="n">ArraySchema</span>
    <span class="n">Schema</span> <span class="o">&lt;|--</span> <span class="n">ObjectSchema</span>
    <span class="n">AtomicSchema</span> <span class="o">&lt;|--</span> <span class="n">OneOfSchema</span>
    <span class="n">AtomicSchema</span> <span class="o">&lt;|--</span> <span class="n">RefToSchema</span>
    <span class="n">ArraySchema</span> <span class="o">&lt;|--</span> <span class="n">DependsOnArraySchema</span>
    <span class="n">RefToSchema</span> <span class="o">--&gt;</span> <span class="n">Schema</span>
    <span class="s1">&#39;OneOfSchema --&gt; &quot;*&quot; Schema : Redefines</span>
    <span class="s1">&#39;ObjectSchema --&gt; &quot;*&quot; Schema : Properties</span>
    <span class="s1">&#39;ArraySchema --&gt; Schema : Items</span>
    <span class="s1">&#39;DependsOnArraySchema --&gt; Schema : maxItems</span>
<span class="nd">@enduml</span>
</pre></div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.ArrayLocation">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">ArrayLocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">item_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">item_count</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">items</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.ArrayLocation" title="Permalink to this definition">¶</a></dt>
<dd><p>type(Schema) == ArraySchema
The location of an array of instances with the same schema. A COBOL <code class="docutils literal notranslate"><span class="pre">OCCURS</span></code> item.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.ArrayLocation.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><span class="pre">stingray.schema_instance.NDNav</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.ArrayLocation.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>An Iterator over tuples of (indent, Location, array indices, raw bytes, value)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.ArraySchema">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">ArraySchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">items</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.ArraySchema" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.ArraySchema.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Nav" title="stingray.schema_instance.Nav"><span class="pre">stingray.schema_instance.Nav</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">'Schema'</span><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.ArraySchema.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield nesting, schema, indices, and object</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.AtomicLocation">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">AtomicLocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.AtomicLocation" title="Permalink to this definition">¶</a></dt>
<dd><p>type(Schema) == AtomicSchema
The location of a COBOL elementary item.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.AtomicLocation.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><span class="pre">stingray.schema_instance.NDNav</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.AtomicLocation.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>An Iterator over tuples of (indent, Location, array indices, raw bytes, value)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.AtomicLocation.value">
<span class="sig-name descname"><span class="pre">value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#stingray.schema_instance.AtomicLocation.value" title="Permalink to this definition">¶</a></dt>
<dd><p>For an atomic value, locate the underlying value. This may involve unpacking.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.AtomicSchema">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">AtomicSchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.AtomicSchema" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.BytesInstance">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">BytesInstance</span></span><a class="headerlink" href="#stingray.schema_instance.BytesInstance" title="Permalink to this definition">¶</a></dt>
<dd><p>Fulfills the protocol for an <code class="docutils literal notranslate"><span class="pre">NDInstance</span></code>, useful for <code class="docutils literal notranslate"><span class="pre">EBCDIC</span></code> and <code class="docutils literal notranslate"><span class="pre">StructUnpacker</span></code>
Unpackers.</p>
<p>To create an <a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><code class="xref py py-class docutils literal notranslate"><span class="pre">NDNav</span></code></a>, this object requires two things:
- A <cite>Schema</cite> used to create <cite>Location</cite> objects.
- An <cite>NonDelimited</cite> subclass of <cite>Unpacker</cite> to provide physical format details like size and unpacking.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">schema</span> <span class="o">=</span> <span class="n">SchemaMaker</span><span class="o">.</span><span class="n">from_json</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field-1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;cobol&quot;</span><span class="p">:</span> <span class="s2">&quot;PIC X(12)&quot;</span><span class="p">}}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unpacker</span> <span class="o">=</span> <span class="n">EBCDIC</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">BytesInstance</span><span class="p">(</span><span class="s1">&#39;blahblahblah&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;CP037&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unpacker</span><span class="o">.</span><span class="n">nav</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s2">&quot;field-1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<span class="go">&#39;blahblahblah&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Sheet.row_iter()</span></code> build <code class="docutils literal notranslate"><span class="pre">Row</span></code> objects that wrap an unpacker, schema, and instance.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.CSVNav">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">CSVNav</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unpacker</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Unpacker" title="stingray.schema_instance.Unpacker"><span class="pre">stingray.schema_instance.Unpacker</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.WBInstance" title="stingray.schema_instance.WBInstance"><span class="pre">stingray.schema_instance.WBInstance</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.WBInstance" title="stingray.schema_instance.WBInstance"><span class="pre">stingray.schema_instance.WBInstance</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.CSVNav" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.DInstance">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">DInstance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.DInstance" title="Permalink to this definition">¶</a></dt>
<dd><p>JSON/YAML/TOML documents are wild and free.
Pragmatically, we want o supplement these classes with methods
that emit <code class="docutils literal notranslate"><span class="pre">DNav</span></code> objects to manage navigating an object and a schema in parallel.</p>
<p>Not sure this is useful…</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.DNav">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">DNav</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unpacker</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Unpacker" title="stingray.schema_instance.Unpacker"><span class="pre">stingray.schema_instance.Unpacker</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.DInstance" title="stingray.schema_instance.DInstance"><span class="pre">stingray.schema_instance.DInstance</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.DNav" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigate through a <code class="docutils literal notranslate"><span class="pre">DInstance</span></code> using a <code class="docutils literal notranslate"><span class="pre">Schema</span></code>.
This is a wrapper around a <code class="docutils literal notranslate"><span class="pre">JSON</span></code> document.</p>
<p>Note that these objects have an inherent ambiguity. 
A JSON document can have the form of a dictionary with names and values.
The schema <em>also</em> names the properties and suggests types.
If the two don’t agree, that’s an instance error, spotted by schema validation.</p>
<p>The JSON/YAML/TOML parsers have types implied by syntax and the schema <em>also</em> has types.</p>
<p>We need an option to validate the instance against the schema.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.DNav.dump">
<span class="sig-name descname"><span class="pre">dump</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#stingray.schema_instance.DNav.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigates a Delimited instance schema and values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.DNav.value">
<span class="sig-name descname"><span class="pre">value</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#stingray.schema_instance.DNav.value" title="Permalink to this definition">¶</a></dt>
<dd><p>The final Python value from the current schema.
Consider refactoring to use Unpacker explicitly</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.Delimited">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">Delimited</span></span><a class="headerlink" href="#stingray.schema_instance.Delimited" title="Permalink to this definition">¶</a></dt>
<dd><p>An Abstract Unpacker for delimited instances, i.e. <code class="docutils literal notranslate"><span class="pre">JSON</span></code> documents.</p>
<p>An instance will be <code class="docutils literal notranslate"><span class="pre">list[Any]</span> <span class="pre">|</span> <span class="pre">dict[str,</span> <span class="pre">Any]</span> <span class="pre">|</span> <span class="pre">Any</span></code>.
It will is built by a separate parser, often <code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code>, YAML, or TOML.</p>
<p>For JSON/YAML/TOML, the instance <em>should</em> have the same structure as the schema.
JSONSchema validation can be applied to confirm this.</p>
<p>For XML, the source instance should be transformed into native Python objects, following
a schema definition. A schema structure may ignore XML tags or extract text from a tag
with a mixed content model.</p>
<p>The sizes and formats of delimited data don’t matter:
the <code class="xref py py-func docutils literal notranslate"><span class="pre">calcsize()</span></code> function returns 1 to act as a position in a sequence of values.</p>
<p>Concrete subclasses include open, close, and instance_iter.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.DependsOnArraySchema">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">DependsOnArraySchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">items</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_to</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.DependsOnArraySchema" title="Permalink to this definition">¶</a></dt>
<dd><p>An array with a size that depends on another field.
The extension “maxItemsDependsOn” attribute has a reference to another
field in this definition.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="stingray.schema_instance.DesignError">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">DesignError</span></span><a class="headerlink" href="#stingray.schema_instance.DesignError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.EBCDIC">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">EBCDIC</span></span><a class="headerlink" href="#stingray.schema_instance.EBCDIC" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpacker for Non-Delimited EBCDIC bytes.</p>
<p>Uses <code class="xref py py-mod docutils literal notranslate"><span class="pre">estruct</span></code> module for calcsize and value of Big-Endian, EBCDIC data.
This requires the “cobol” and “conversion” keywords, part of the extended vocabulary for COBOL.
A <cite>“cobol”</cite> keyword gets Usage and Picture values required to decode EBCDIC. 
A “conversion” keyword converts to a more useful Python type.</p>
<p>This assumes the 
COBOL encoded numeric can be <code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:</span> <span class="pre">&quot;string&quot;</span></code> with additional <code class="docutils literal notranslate"><span class="pre">&quot;contentEncoding&quot;</span></code> details.</p>
<p>This class implements a <code class="docutils literal notranslate"><span class="pre">&quot;contentEncoding&quot;</span></code> using values of “packed-decimal”, and “cp037”,
to unwind COBOL Packed Decimal and Binary as strings of bytes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.EBCDIC.instance_iter">
<span class="sig-name descname"><span class="pre">instance_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sheet</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recfm_class</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.estruct.RECFM_Reader" title="stingray.estruct.RECFM_Reader"><span class="pre">stingray.estruct.RECFM_Reader</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lrecl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.EBCDIC.instance_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegate instance iteration to a recfm_parser instance.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.EBCDIC.used">
<span class="sig-name descname"><span class="pre">used</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#stingray.schema_instance.EBCDIC.used" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegate number of bytes consumed to the recfm_parser.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.Location">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">Location</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.Location" title="Permalink to this definition">¶</a></dt>
<dd><p>A Location is used to navigate within an <cite>NDInstance</cite> objects.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Unpacker[NDInstance]</span></code> strategy is a subclass of NonDelimited,
one of EBCDIC(), Struct(), or TextUnpacker().</p>
<p>The value() method delegates the work to the <code class="docutils literal notranslate"><span class="pre">Unpacker</span></code> strategy.</p>
<p>TODO: Add unpacker and locationMaker to __init__() method.</p>
<dl class="py property">
<dt class="sig sig-object py" id="stingray.schema_instance.Location.referent">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">referent</span></span><em class="property"><span class="pre">:</span> <a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a></em><a class="headerlink" href="#stingray.schema_instance.Location.referent" title="Permalink to this definition">¶</a></dt>
<dd><p>Most things refer to themselves. a RefToLocation, however, overrides this.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.LocationMaker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">LocationMaker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unpacker</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Unpacker" title="stingray.schema_instance.Unpacker"><span class="pre">stingray.schema_instance.Unpacker</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.LocationMaker" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates <code class="docutils literal notranslate"><span class="pre">Location</span></code> objects to find sub-instances in a non-delimited <code class="docutils literal notranslate"><span class="pre">NDInstance</span></code>.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">LocationMaker</span></code> walks through a <code class="docutils literal notranslate"><span class="pre">Schema</span></code> structure applied to a <code class="docutils literal notranslate"><span class="pre">NDInstance</span></code> to
emit <code class="docutils literal notranslate"><span class="pre">Location</span></code> objects. This is based on the current values in the <cite>NDInstance</cite>,
to support providing a properly-computed value for <code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code> arrays.</p>
<p>This is based on an <cite>NDUnpacker</cite> definition of the physical format of the file.
It’s only used for non-delimited files where the underlying <cite>NDInstance</cite> is <cite>Union[bytes, str]</cite>.</p>
<p>This creates <code class="docutils literal notranslate"><span class="pre">NDNav</span></code> isntances for navigation through Non-Delimited instances.</p>
<p>The algorithm is a post-order traversal of the subschema to build <cite>Location</cite> instances
that contain references to their children.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.LocationMaker.from_schema">
<span class="sig-name descname"><span class="pre">from_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a></span></span><a class="headerlink" href="#stingray.schema_instance.LocationMaker.from_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>May raise an exception if there is an <code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.LocationMaker.walk">
<span class="sig-name descname"><span class="pre">walk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a></span></span><a class="headerlink" href="#stingray.schema_instance.LocationMaker.walk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.NDInstance">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">NDInstance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.NDInstance" title="Permalink to this definition">¶</a></dt>
<dd><p>The essential features of a non-delimited instance.
The underlying data is <code class="docutils literal notranslate"><span class="pre">AnyStr</span></code>, either bytes or text.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.NDNav">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">NDNav</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unpacker</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Unpacker" title="stingray.schema_instance.Unpacker"><span class="pre">stingray.schema_instance.Unpacker</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">location</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.NDNav" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigate through an <code class="docutils literal notranslate"><span class="pre">NDInstance</span></code> using <code class="docutils literal notranslate"><span class="pre">Location</span></code> as a helper.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.NDNav.dump">
<span class="sig-name descname"><span class="pre">dump</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#stingray.schema_instance.NDNav.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigates a non-delimited Schema using <a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><code class="xref py py-class docutils literal notranslate"><span class="pre">Location</span></code></a> (based on the Schema)
to expose values in the instance.
This is similar to the way DNav and WBNav objects work.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.NDNav.index">
<span class="sig-name descname"><span class="pre">index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><span class="pre">stingray.schema_instance.NDNav</span></a></span></span><a class="headerlink" href="#stingray.schema_instance.NDNav.index" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute an offset into the array of items.
Create a special <code class="docutils literal notranslate"><span class="pre">Location</span></code> for the requested index value.
The location, attribute, assigned to <code class="docutils literal notranslate"><span class="pre">base_location</span></code>, is for index == 0.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.NDNav.name">
<span class="sig-name descname"><span class="pre">name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><span class="pre">stingray.schema_instance.NDNav</span></a></span></span><a class="headerlink" href="#stingray.schema_instance.NDNav.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Locate the “$anchor” in the <code class="docutils literal notranslate"><span class="pre">Schema</span></code> and the related <code class="docutils literal notranslate"><span class="pre">Location</span></code>.
Return a new <code class="docutils literal notranslate"><span class="pre">NDNav</span></code> for the requested anchor or property name.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.NDNav.raw">
<span class="sig-name descname"><span class="pre">raw</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#stingray.schema_instance.NDNav.raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Raw bytes (or text) from the current schema and location.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.NDNav.raw_instance">
<span class="sig-name descname"><span class="pre">raw_instance</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a></span></span><a class="headerlink" href="#stingray.schema_instance.NDNav.raw_instance" title="Permalink to this definition">¶</a></dt>
<dd><p>Clone a piece of this instance as a new <a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><code class="xref py py-class docutils literal notranslate"><span class="pre">NDInstance</span></code></a> object.
Since NDInstance is Union[BytesInstance, TextInstance], there are two paths:
a new bytes or a new str.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.NDNav.value">
<span class="sig-name descname"><span class="pre">value</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#stingray.schema_instance.NDNav.value" title="Permalink to this definition">¶</a></dt>
<dd><p>The final Python value from the current schema and location.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.Nav">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">Nav</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.Nav" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigation into items by field name or index into an array.</p>
<ul class="simple">
<li><p>For Non-Delimited, names as well as indices are required for object and array navigation.</p></li>
<li><p>For Delimited, a name or an index can be used, depending on what the underlying Python
Instance object is. Dictionaries use names, lists use indices.</p></li>
<li><p>For Workbook, an index is used because we only know the cells of a row by position.</p></li>
</ul>
<p>A <code class="docutils literal notranslate"><span class="pre">Nav</span></code> is built by an <code class="docutils literal notranslate"><span class="pre">Unpacker</span></code>.
<code class="docutils literal notranslate"><span class="pre">unpacker.nav(schema,</span> <span class="pre">instance)</span></code>.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.ObjectLocation">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">ObjectLocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">'Location'</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.ObjectLocation" title="Permalink to this definition">¶</a></dt>
<dd><p>type(Schema) == ObjectSchema
The location of an object with a dictionary of named properties. A COBOL group-level item.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.ObjectLocation.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><span class="pre">stingray.schema_instance.NDNav</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.ObjectLocation.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>An Iterator over tuples of (indent, Location, array indices, raw bytes, value)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.ObjectSchema">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">ObjectSchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">'Schema'</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.ObjectSchema" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.ObjectSchema.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Nav" title="stingray.schema_instance.Nav"><span class="pre">stingray.schema_instance.Nav</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">'Schema'</span><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.ObjectSchema.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield nesting, schema, indices, and object</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.OneOfLocation">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">OneOfLocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">alternatives</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.OneOfLocation" title="Permalink to this definition">¶</a></dt>
<dd><p>type(Schema) == OneOfSchema
The location of an object which has a list of REDEFINES alternatives.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.OneOfLocation.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><span class="pre">stingray.schema_instance.NDNav</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.OneOfLocation.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>An Iterator over tuples of (indent, Location, array indices, raw bytes, value)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.OneOfSchema">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">OneOfSchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alternatives</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">'Schema'</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.OneOfSchema" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.OneOfSchema.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Nav" title="stingray.schema_instance.Nav"><span class="pre">stingray.schema_instance.Nav</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">'Schema'</span><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.OneOfSchema.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield nesting, schema, indices, and object</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.RefToLocation">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">RefToLocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">anchors</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.RefToLocation" title="Permalink to this definition">¶</a></dt>
<dd><p>type(Schema) == RefToSchema
Part of REDEFINES; this is the COBOL-visible name of a path into a <code class="docutils literal notranslate"><span class="pre">OneOfLocation</span></code> alternative.</p>
<p>This could also be part of OCCURS DEPENDING ON.
If used like this, it would be the COBOL-visible name of an item with an array size.
The OCCURS DEPENDING ON doesn’t formalize this, however.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.RefToLocation.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><span class="pre">stingray.schema_instance.NDNav</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.RefToLocation.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>An Iterator over tuples of (indent, Location, array indices, raw bytes, value)
These are silenced – they were already displayed in an earlier OneOf.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="stingray.schema_instance.RefToLocation.referent">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">referent</span></span><em class="property"><span class="pre">:</span> <a class="reference internal" href="#stingray.schema_instance.Location" title="stingray.schema_instance.Location"><span class="pre">stingray.schema_instance.Location</span></a></em><a class="headerlink" href="#stingray.schema_instance.RefToLocation.referent" title="Permalink to this definition">¶</a></dt>
<dd><p>Most things refer to themselves. a RefToLocation, however, overrides this.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.RefToSchema">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">RefToSchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_to</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.RefToSchema" title="Permalink to this definition">¶</a></dt>
<dd><p>Must deference type and attributes properties.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.RefToSchema.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Nav" title="stingray.schema_instance.Nav"><span class="pre">stingray.schema_instance.Nav</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">'Schema'</span><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.RefToSchema.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield nesting, schema, indices, and object</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.Reference">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">Reference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.Reference" title="Permalink to this definition">¶</a></dt>
<dd><p># TODO: Formalize a ref_to protocol, used by <code class="docutils literal notranslate"><span class="pre">RefToSchema</span></code> and <code class="docutils literal notranslate"><span class="pre">DependsOnArraySchema</span></code>.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.Schema">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">Schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.Schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for Schema definitions.</p>
<p>This is Python class that wraps the a JSONSchema definition.
The class provides slightly simpler navigation via attribute names
instead of dictionary keys.</p>
<p>Generally, these should be seen as immutable. To permit forward
references, the RefTo subclass needs to be mutated.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.Schema.dump_iter">
<span class="sig-name descname"><span class="pre">dump_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nav</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.Nav" title="stingray.schema_instance.Nav"><span class="pre">stingray.schema_instance.Nav</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">'Schema'</span><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.schema_instance.Schema.dump_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield nesting, schema, indices, and value</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.SchemaMaker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">SchemaMaker</span></span><a class="headerlink" href="#stingray.schema_instance.SchemaMaker" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Schema structure from a JSON Schema document.</p>
<p>This doesn’t do much, but it allows us to use classes to define methods 
that apply to the JSON Schema constructs instead of referring to them 
as the source document dictionaries.</p>
<p>All <code class="docutils literal notranslate"><span class="pre">$ref</span></code> names are expected to refer to explicit <code class="docutils literal notranslate"><span class="pre">:anchor</span></code> names within this schema.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.SchemaMaker.resolve">
<span class="sig-name descname"><span class="pre">resolve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></span><a class="headerlink" href="#stingray.schema_instance.SchemaMaker.resolve" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve forward $ref references.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.SchemaMaker.walk_schema">
<span class="sig-name descname"><span class="pre">walk_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></span><a class="headerlink" href="#stingray.schema_instance.SchemaMaker.walk_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Starting with JSON Schema document, create Schema objects.
Relies on an <code class="docutils literal notranslate"><span class="pre">maxItemsDependsOn</span></code> extension to describe <cite>OCCURS DEPENDING ON</cite>.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.Struct">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">Struct</span></span><a class="headerlink" href="#stingray.schema_instance.Struct" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpacker for Non-Delimited native (i.e., not EBCDIC-encoding) bytes.</p>
<p>Uses built-in <code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code> module for calcsize and value.
TODO: Finish this.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.TextInstance">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">TextInstance</span></span><a class="headerlink" href="#stingray.schema_instance.TextInstance" title="Permalink to this definition">¶</a></dt>
<dd><p>Fulfills the protocol for an <code class="docutils literal notranslate"><span class="pre">NDInstance</span></code>. Useful for <code class="docutils literal notranslate"><span class="pre">TextUnpacker</span></code>.</p>
<p>To create an <a class="reference internal" href="#stingray.schema_instance.NDNav" title="stingray.schema_instance.NDNav"><code class="xref py py-class docutils literal notranslate"><span class="pre">NDNav</span></code></a>, this object requires two things:
- A <cite>Schema</cite> which populates the <cite>Location</cite> objects.
- An <cite>NonDelimited</cite> subclass of <cite>Unpacker</cite> to provide physical format details like size and unpacking.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">schema</span> <span class="o">=</span> <span class="n">SchemaMaker</span><span class="o">.</span><span class="n">from_json</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field-1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;cobol&quot;</span><span class="p">:</span> <span class="s2">&quot;PIC X(12)&quot;</span><span class="p">}}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unpacker</span> <span class="o">=</span> <span class="n">TextUnpacker</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">TextInstance</span><span class="p">(</span><span class="s1">&#39;blahblahblah&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unpacker</span><span class="o">.</span><span class="n">nav</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s2">&quot;field-1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<span class="go">&#39;blahblahblah&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Sheet.row_iter()</span></code> build <code class="docutils literal notranslate"><span class="pre">Row</span></code> objects that wrap an unpacker, schema, and instance.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.TextUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">TextUnpacker</span></span><a class="headerlink" href="#stingray.schema_instance.TextUnpacker" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpacker for Non-Delimited text values.</p>
<p>Uses string slicing and built-ins.
This is for a native Unicode (or ASCII) text-based format.
If utf-16 is being used, this is effectively a Double-Byte Character Set used by COBOL.</p>
<p>A universal approach is to include <code class="docutils literal notranslate"><span class="pre">maxLength</span></code> (optionally <code class="docutils literal notranslate"><span class="pre">minLength</span></code>) attributes 
on each field. <code class="docutils literal notranslate"><span class="pre">maxLength</span></code> == the length of the field == <code class="docutils literal notranslate"><span class="pre">minLength</span></code>.</p>
<p>While it’s tempting to use “type”: “number” on this text data, it can be technically suspicious.
If file has strings, conversions may part of the application’s use 
of the data, not the data itself. We use a “conversion” keyword to do these conversions
from external string to internal Python object.</p>
<p>For various native bytes formats, this is a <cite>{“type”: “string”, “contentEncoding”: “struct-xxx”}</cite>
where the Python <code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code> module codes are used to define the number of interpretation of the bytes.</p>
<p>For COBOL, the “cobol” keyword provides USAGE and PICTURE. This defines size.
In this case, since it’s not in EBCDIC, we can use <code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code> to unpack COMP values.</p>
<p>This requires the “cobol” and “conversion” keywords, part of the extended vocabulary for COBOL.
A <cite>“cobol”</cite> keyword gets Usage and Picture values required to decode EBCDIC. 
A “conversion” keyword converts to a more useful Python type.</p>
<p>(An alternative approach is to use the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> attribute to provide length information.
This is often {“type”: “string”, “pattern”: “^.{64}$”} or similar. This can provide a length.
Because patterns can be hard to reverse engineer, we don’t use this.)</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.Unpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">Unpacker</span></span><a class="headerlink" href="#stingray.schema_instance.Unpacker" title="Permalink to this definition">¶</a></dt>
<dd><p>An Unpacker helps convert data from an <code class="docutils literal notranslate"><span class="pre">Instance</span></code>.
For NDInstances, this involves size calculations and value conversions.
For WBInstances and JSON, this is a pass-through because the sizes don’t matter and
the values are already Native Python objects.</p>
<p>An Unpacker is a generic procotol. A class that implements the protocol <strong>should</strong>
provide all of the methods.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.WBInstance">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">WBInstance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.WBInstance" title="Permalink to this definition">¶</a></dt>
<dd><p>CSV files are <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>. All other workbooks tend to be  <code class="docutils literal notranslate"><span class="pre">list[Any]</span></code>
because their unpacker modules do conversions.
We’ll tolerate any sequence type.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.WBNav">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">WBNav</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unpacker</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Unpacker" title="stingray.schema_instance.Unpacker"><span class="pre">stingray.schema_instance.Unpacker</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.WBInstance" title="stingray.schema_instance.WBInstance"><span class="pre">stingray.schema_instance.WBInstance</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.WBInstance" title="stingray.schema_instance.WBInstance"><span class="pre">stingray.schema_instance.WBInstance</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.schema_instance.WBNav" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigate through a workbook <code class="docutils literal notranslate"><span class="pre">WBInstance</span></code> using a <code class="docutils literal notranslate"><span class="pre">Schema</span></code>.</p>
<p>A Workbook Row is a <code class="docutils literal notranslate"><span class="pre">Sequence[Any]</span></code> of cell values. Therefore, navigation
by name translates to a position within the <code class="docutils literal notranslate"><span class="pre">WBInstance</span></code> row.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.WBNav.dump">
<span class="sig-name descname"><span class="pre">dump</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#stingray.schema_instance.WBNav.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Navigates a Workbook instance schema and values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.schema_instance.WBNav.value">
<span class="sig-name descname"><span class="pre">value</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#stingray.schema_instance.WBNav.value" title="Permalink to this definition">¶</a></dt>
<dd><p>The final Python value from the current schema – relies on the Unpacker.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.schema_instance.WBUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.schema_instance.</span></span><span class="sig-name descname"><span class="pre">WBUnpacker</span></span><a class="headerlink" href="#stingray.schema_instance.WBUnpacker" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpacker for Workbook-defined values.</p>
<p>Most of WBInstances defer to another module for unpacking.
CSV, however, relies on the <code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code> module, where the instance is <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>.</p>
<p>While it’s tempting to use “type”: “number” on CSV data, it’s technically suspicious.
The file has strings, and only strings. Conversions are part of the application’s use 
of the data, not the data itself. The schema can use the <code class="docutils literal notranslate"><span class="pre">&quot;conversion&quot;</span></code> keyword
to specify one of the conversion functions.</p>
</dd></dl>

</section>
</section>
</section>
<section id="module-stingray.estruct">
<span id="structure-unpacking"></span><h2>Structure Unpacking<a class="headerlink" href="#module-stingray.estruct" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">estruct</span></code> module unpacks EBCDIC-encoded values. It is a big-endian version of the <code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code> module. 
It uses two COBOL clauses, <code class="docutils literal notranslate"><span class="pre">USAGE</span></code> and <code class="docutils literal notranslate"><span class="pre">PIC</span></code>, to describe the format of data represented by a sequence of bytes.</p>
<p>The format string can be <code class="docutils literal notranslate"><span class="pre">'USAGE</span> <span class="pre">DISPLAY</span> <span class="pre">PIC</span> <span class="pre">S999.99'</span></code>, for example. A full DDE line of code is tolerated, making it easier to transform COBOL to <code class="xref py py-mod docutils literal notranslate"><span class="pre">estruct</span></code> formats.</p>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code> module uses a compact format string describe data. 
This string is used unpack text, int, and float values from a sequence of bytes. See <a class="reference external" href="https://docs.python.org/3/library/struct.html#format-characters">https://docs.python.org/3/library/struct.html#format-characters</a>.</p>
<p>An alternative interface for this module could be to use single-letter codes. <code class="docutils literal notranslate"><span class="pre">15x</span></code> for display. <code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> for COMP-1 and COMP-2. <code class="docutils literal notranslate"><span class="pre">9.2p</span></code> for <code class="docutils literal notranslate"><span class="pre">PIC</span> <span class="pre">9(9)V99</span></code> packed decimal COMP-3. <code class="docutils literal notranslate"><span class="pre">9.2n</span></code> for zoned decimal text. Plus <code class="docutils literal notranslate"><span class="pre">h</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>, and <code class="docutils literal notranslate"><span class="pre">l</span></code> for COMP-4 variants. This seems needless, but it is compact and somewhat more compatible with the <code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code> module.</p>
<section id="file-reading">
<h3>File Reading<a class="headerlink" href="#file-reading" title="Permalink to this headline">¶</a></h3>
<p>The EBCDIC files can include physical “Record Format” (RECFM) assistance.
These classes define a number of Z/OS RECFM conversion. We recognize four
actual RECFM’s plus an additional special case.</p>
<ul class="simple">
<li><p>F - Fixed.</p></li>
<li><p>FB - Fixed Blocked.</p></li>
<li><p>V - Variable, each record is preceded by a 4-byte Record Description Word (RDW).</p></li>
<li><p>VB - Variable Blocked. Blocks have Block Description Word (BDW); each record within a block has a Record Description Word.</p></li>
<li><p>N - Variable, but without BDW or RDW words. This involves some buffer management
magic to recover the records properly. This is required to handle <code class="docutils literal notranslate"><span class="pre">Occurs</span> <span class="pre">Depending</span> <span class="pre">On</span></code> cases
where there’s no V or VB header. This requires the consumer of bytes to announce how many bytes
were consumed so the reader can advance an appropriate amount.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>IBM z/Architecture mainframes are all big-endian</p>
</div>
</section>
<section id="module-contents">
<h3>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="#stingray.estruct.Representation" title="stingray.estruct.Representation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Representation</span></code></a> extracts details of representation from COBOL DDE.</p></li>
<li><p><a class="reference internal" href="#stingray.estruct.unpack" title="stingray.estruct.unpack"><code class="xref py py-func docutils literal notranslate"><span class="pre">unpack()</span></code></a> Unpacks EBCDIC data.</p></li>
<li><p><a class="reference internal" href="#stingray.estruct.calcsize" title="stingray.estruct.calcsize"><code class="xref py py-class docutils literal notranslate"><span class="pre">calcsize</span></code></a> Computes the size of an atomic field.</p></li>
<li><p><a class="reference internal" href="#stingray.estruct.RECFM_Reader" title="stingray.estruct.RECFM_Reader"><code class="xref py py-class docutils literal notranslate"><span class="pre">RECFM_Reader</span></code></a> a family of classes to read data in various physical formats.</p></li>
</ul>
<dl class="py exception">
<dt class="sig sig-object py" id="stingray.estruct.DesignError">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">DesignError</span></span><a class="headerlink" href="#stingray.estruct.DesignError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_F">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">RECFM_F</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">BinaryIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lrecl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.estruct.RECFM_F" title="Permalink to this definition">¶</a></dt>
<dd><p>Read RECFM=F. 
The schema’s record size is the lrecl, logical record length.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_F.rdw_iter">
<span class="sig-name descname"><span class="pre">rdw_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_F.rdw_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield rows with RDW injected, these look like RECFM_V format as a standard.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_F.record_iter">
<span class="sig-name descname"><span class="pre">record_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_F.record_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns each physical record, stripped of headers.</p>
</dd></dl>

</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_FB">
<span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">RECFM_FB</span></span><a class="headerlink" href="#stingray.estruct.RECFM_FB" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#stingray.estruct.RECFM_F" title="stingray.estruct.RECFM_F"><code class="xref py py-class docutils literal notranslate"><span class="pre">stingray.estruct.RECFM_F</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_N">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">RECFM_N</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">BinaryIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lrecl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.estruct.RECFM_N" title="Permalink to this definition">¶</a></dt>
<dd><p>Read variable-length records without RDW (or BDW).
In the case of <code class="docutils literal notranslate"><span class="pre">Occurs</span> <span class="pre">Depending</span> <span class="pre">On</span></code>, the schema doesn’t have  single, fixed size. 
The client of this class announces how the bytes were actually used.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_N.record_iter">
<span class="sig-name descname"><span class="pre">record_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_N.record_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns each physical record, stripped of headers.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_Reader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">RECFM_Reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">BinaryIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lrecl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.estruct.RECFM_Reader" title="Permalink to this definition">¶</a></dt>
<dd><p>Read records based on a physical file format.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_Reader.record_iter">
<em class="property"><span class="pre">abstract</span> </em><span class="sig-name descname"><span class="pre">record_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_Reader.record_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns each physical record, stripped of headers.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_Reader.used">
<span class="sig-name descname"><span class="pre">used</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_Reader.used" title="Permalink to this definition">¶</a></dt>
<dd><p>Used by a row to announce the number of bytes consumed.
Supports the rare case of RECFM_N, where records are variable length with no RDW or BDW headers.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_V">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">RECFM_V</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">BinaryIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lrecl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.estruct.RECFM_V" title="Permalink to this definition">¶</a></dt>
<dd><p>Read RECFM=V.
The schema’s record size is irrelevant. 
Each record has a 4-byte Record Descriptor Word (RDW) followed by the data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_V.rdw_iter">
<span class="sig-name descname"><span class="pre">rdw_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_V.rdw_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over records which include the 4-byte RDW.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_V.record_iter">
<span class="sig-name descname"><span class="pre">record_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_V.record_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over records, stripped of RDW’s.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_VB">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">RECFM_VB</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">BinaryIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lrecl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.estruct.RECFM_VB" title="Permalink to this definition">¶</a></dt>
<dd><p>Read RECFM=VB. 
The schema’s record size is irrelevant. 
Each record has a 4-byte Record Descriptor Word (RDW) followed by the data.
Each block has a 4-byte Block Descriptor Word (BDW) followed by records.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_VB.bdw_iter">
<span class="sig-name descname"><span class="pre">bdw_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_VB.bdw_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over blocks, which include 4-byte BDW and records with 4-byte RDW’s.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_VB.rdw_iter">
<span class="sig-name descname"><span class="pre">rdw_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_VB.rdw_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over records which include the 4-byte RDW.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.RECFM_VB.record_iter">
<span class="sig-name descname"><span class="pre">record_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.estruct.RECFM_VB.record_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over records, stripped of RDW’s.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.estruct.Representation">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">Representation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">usage</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">picture_elements</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">picture_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.estruct.Representation" title="Permalink to this definition">¶</a></dt>
<dd><p>COBOL Representation Details: Usage and Picture.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Representation</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;USAGE DISPLAY PICTURE S9(5)V99&quot;</span><span class="p">)</span>
<span class="go">Representation(usage=&#39;DISPLAY&#39;, picture_elements=[{&#39;sign&#39;: &#39;S&#39;}, {&#39;digit&#39;: &#39;99999&#39;}, {&#39;decimal&#39;: &#39;V&#39;}, {&#39;digit&#39;: &#39;99&#39;}], picture_size=8, pattern=&#39;[ +-]?\\d\\d\\d\\d\\d\\d\\d&#39;)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.estruct.Representation.parse">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.estruct.Representation" title="stingray.estruct.Representation"><span class="pre">stingray.estruct.Representation</span></a></span></span><a class="headerlink" href="#stingray.estruct.Representation.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse the COBOL DDE information.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stingray.estruct.Representation.pattern">
<span class="sig-name descname"><span class="pre">pattern</span></span><em class="property"><span class="pre">:</span> <span class="pre">str</span></em><a class="headerlink" href="#stingray.estruct.Representation.pattern" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stingray.estruct.Representation.picture_elements">
<span class="sig-name descname"><span class="pre">picture_elements</span></span><em class="property"><span class="pre">:</span> <span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#stingray.estruct.Representation.picture_elements" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stingray.estruct.Representation.picture_size">
<span class="sig-name descname"><span class="pre">picture_size</span></span><em class="property"><span class="pre">:</span> <span class="pre">int</span></em><a class="headerlink" href="#stingray.estruct.Representation.picture_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stingray.estruct.Representation.usage">
<span class="sig-name descname"><span class="pre">usage</span></span><em class="property"><span class="pre">:</span> <span class="pre">str</span></em><a class="headerlink" href="#stingray.estruct.Representation.usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.estruct.calcsize">
<span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">calcsize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#stingray.estruct.calcsize" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the size, in bytes for an elementary (non-group-level) COBOL DDE format specification.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.estruct.unpack">
<span class="sig-prename descclassname"><span class="pre">stingray.estruct.</span></span><span class="sig-name descname"><span class="pre">unpack</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bytes</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#stingray.estruct.unpack" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpack EBCDIC bytes given a COBOL DDE format specification and a buffer of bytes.</p>
<p>USAGE DISPLAY special case: “external decimal” sometimes called “zoned decimal”.
The PICTURE character-string of an external decimal item can contain only:
One or more of the symbol 9
The operational-sign, S
The assumed decimal point, V
One or more of the symbol P</p>
<p>External decimal items with USAGE DISPLAY are sometimes referred to as zoned decimal items. 
Each digit of a number is represented by a single byte. 
The 4 high-order bits of each byte are zone bits; 
the 4 high-order bits of the low-order byte represent the sign of the item. 
The 4 low-order bits of each byte contain the value of the digit.</p>
<p>TODO: Add support for COMP-1 and COMP-2.</p>
</dd></dl>

</section>
</section>
<section id="module-stingray.cobol_parser">
<span id="cobol-source-parsing"></span><h2>COBOL Source Parsing<a class="headerlink" href="#module-stingray.cobol_parser" title="Permalink to this headline">¶</a></h2>
<p>COBOL DDE Parser and JSONSchema Builder.</p>
<section id="cobol">
<h3>COBOL<a class="headerlink" href="#cobol" title="Permalink to this headline">¶</a></h3>
<p>A COBOL “Copybook” is a group-level DDE.
See <a class="reference external" href="https://www.ibm.com/docs/en/cobol-zos/4.2?topic=division-data-data-description-entry">https://www.ibm.com/docs/en/cobol-zos/4.2?topic=division-data-data-description-entry</a></p>
<p>There are three formats for DDE’s. We only really care about one of them.</p>
<ul class="simple">
<li><p>Format 1 is the useful DDE level numbers 01 to 49 and 77.</p></li>
<li><p>Format 2 is a RENAMES clause, level 66. We don’t support this.</p></li>
</ul>
<p>. Format 3 is a CONDITION, level 88. This is a kind of enumeration of values; we tolerate it, but don’t do anything with it.</p>
<p>Here’s the railroad diagramm for each sentence. Clauses after level-number and data-name-1 can appear in any order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;-</span><span class="n">level</span><span class="o">-</span><span class="n">number</span><span class="o">--+-------------+--+------------------+----------&gt;</span>
                 <span class="o">+-</span><span class="n">data</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="mi">1</span><span class="o">-+</span>  <span class="s1">&#39;-redefines-clause-&#39;</span>
                 <span class="s1">&#39;-FILLER------&#39;</span>

<span class="o">&gt;--+------------------------+--+-----------------+--------------&gt;</span>
   <span class="s1">&#39;-blank-when-zero-clause-&#39;</span>  <span class="s1">&#39;-external-clause-&#39;</span>

<span class="o">&gt;--+---------------+--+--------------------+--------------------&gt;</span>
   <span class="s1">&#39;-global-clause-&#39;</span>  <span class="s1">&#39;-group-usage-clause-&#39;</span>

<span class="o">&gt;--+------------------+--+---------------+----------------------&gt;</span>
   <span class="s1">&#39;-justified-clause-&#39;</span>  <span class="s1">&#39;-occurs-clause-&#39;</span>

<span class="o">&gt;--+----------------+--+-------------+--------------------------&gt;</span>
   <span class="s1">&#39;-picture-clause-&#39;</span>  <span class="s1">&#39;-sign-clause-&#39;</span>

<span class="o">&gt;--+---------------------+--+--------------+--------------------&gt;</span>
   <span class="s1">&#39;-synchronized-clause-&#39;</span>  <span class="s1">&#39;-usage-clause-&#39;</span>

<span class="o">&gt;--+--------------+--+--------------------+--------------------&gt;&lt;</span>
   <span class="s1">&#39;-value-clause-&#39;</span>  <span class="s1">&#39;-date-format-clause-&#39;</span>
</pre></div>
</div>
<p>A separator period occurs at the end of the sentence. (It’s described elsewhere in the COBOL language reference.)</p>
<p>For simple examples, see <a class="reference external" href="https://github.com/rradclif/mortgagesample/tree/master/MortgageApplication/copybook">https://github.com/rradclif/mortgagesample/tree/master/MortgageApplication/copybook</a></p>
<p>For comprehensive, complex examples, see
<a class="reference external" href="https://github.com/royopa/cb2xml/tree/ec83af657b781afd0dad9cc263623faa2549f738/source/cb2xml_tests/src/common/cobolCopybook">https://github.com/royopa/cb2xml/tree/ec83af657b781afd0dad9cc263623faa2549f738/source/cb2xml_tests/src/common/cobolCopybook</a></p>
<p>These cover a large number of COBOL-to-XML cases.</p>
</section>
<section id="approach">
<h3>Approach<a class="headerlink" href="#approach" title="Permalink to this headline">¶</a></h3>
<p>We can use a (long) regular expression to parse the various clauses.
This defines the entire DDE syntax.</p>
<p>Beyond the essential language syntax, there’s a “reference format” for source code.
For this format, we need to remove positions 1-6 and 72-80. Position 7 may involve a comment indicator, “*”, or a continuation character, “-“.
See <a class="reference external" href="https://www.ibm.com/docs/en/cobol-zos/4.2?topic=structure-reference-format">https://www.ibm.com/docs/en/cobol-zos/4.2?topic=structure-reference-format</a>.</p>
</section>
<section id="id2">
<h3>Goals<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>This module’s purpose is to translate COBOL to JSON Schema. This involves the following kinds of transformations:</p>
<ul>
<li><p>Group level items become “type”: “object”.</p></li>
<li><p>Elementary items become one of the atomic types, “string”, “integer”, “number”. If an extened vocabulary is used, then “decimal” can be used, also.</p></li>
<li><p>Occurs items become <code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:</span> <span class="pre">&quot;array&quot;</span></code>. There are additional special cases.</p>
<blockquote>
<div><ul class="simple">
<li><p>An item with both OCCURS and a PICTURE becomes an anonymous array that contains the elementary item.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OCCURS</span> <span class="pre">DEPENDING</span> <span class="pre">ON</span></code> builds a <code class="docutils literal notranslate"><span class="pre">&quot;$ref&quot;:</span> <span class="pre">&quot;#name&quot;</span></code> to a <code class="docutils literal notranslate"><span class="pre">&quot;$anchor&quot;:</span> <span class="pre">&quot;name&quot;</span></code> item in the schema.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">REDEFINES</span></code> refers to another item under this parent. While this is similar to a “oneOf” definition, it’s a bit more complex because the alternatives each have separate names. The structure is not simply a <code class="docutils literal notranslate"><span class="pre">{&quot;name&quot;:</span> <span class="pre">{&quot;type&quot;:</span> <span class="pre">{&quot;oneOf&quot;:</span> <span class="pre">[base-A,</span> <span class="pre">redefine-B,</span> <span class="pre">redefine-C,</span> <span class="pre">etc.]}}</span></code>.
The “redefines” property is effectively anonymous and each of the subtypes has a distinct name. It’s <code class="docutils literal notranslate"><span class="pre">{&quot;redefine-A-B-C&quot;:</span> <span class="pre">{&quot;type&quot;:</span> <span class="pre">{&quot;oneOf&quot;:</span> <span class="pre">[{&quot;type&quot;:</span> <span class="pre">&quot;object&quot;,</span> <span class="pre">&quot;properties&quot;:</span> <span class="pre">{&quot;A&quot;:</span> <span class="pre">base}},</span> <span class="pre">{&quot;type:</span> <span class="pre">&quot;object&quot;,</span> <span class="pre">&quot;properties&quot;:</span> <span class="pre">{&quot;B&quot;:</span> <span class="pre">redefined}},</span> <span class="pre">etc.]}}}</span></code>.
This is cumbersome, but is required to capture the COBOL semantics accurately in JSONSchema.</p></li>
</ul>
<p>We require some extensions or adaptations to cover two COBOL issues:</p>
<ul class="simple">
<li><p>COBOL encoded data (Packed-Decimal, Binary, etc.) JSON Schema presumes delimited files with a parser’s conversions of data. For COBOL, the parsing is driven from the JSON Schema, therefore additional details are required. This includes the <code class="docutils literal notranslate"><span class="pre">contentEncoding</span></code> and a conversion function.</p></li>
<li><p>Occurs Depending On reference. JSON Schema limits the maxItems to an unsigned integer. We have to provide an alternative keyword for this.</p></li>
</ul>
<p>It is also handy to have a “cobol” keyword with the original source text.</p>
<p>Because COBOL flattens the namespace of records, we define an <code class="docutils literal notranslate"><span class="pre">$anchor</span></code> for each individual field to make them easier to search for.</p>
<dl class="py class">
<dt class="sig sig-object py" id="stingray.cobol_parser.DDE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">DDE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">sentence</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clauses</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.cobol_parser.DDE" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance of a COBOL DDE.</p>
<p>For name == “FILLER”, this assigns a unique internal name.
A class-level counter is used.</p>
<p>Note that level of “01” resets the counter.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="stingray.cobol_parser.DesignError">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">DesignError</span></span><a class="headerlink" href="#stingray.cobol_parser.DesignError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.cobol_parser.JSONSchemaMaker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">JSONSchemaMaker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.cobol_parser.DDE" title="stingray.cobol_parser.DDE"><span class="pre">stingray.cobol_parser.DDE</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.cobol_parser.JSONSchemaMaker" title="Permalink to this definition">¶</a></dt>
<dd><p>Translate COBOL DDE to JSONSchema.</p>
<p>This handles REDEFINES and OCCURS DEPENDING ON.</p>
<ul class="simple">
<li><p>REDEFINES becomes a <code class="docutils literal notranslate"><span class="pre">oneOf</span></code> with the alternatives.</p></li>
<li><p>OCCURS DEPENDING On uses a <code class="docutils literal notranslate"><span class="pre">maxItemsDependsOn</span></code> vocabulary extension.</p></li>
</ul>
<p>COBOL “flattens” the namespace so an elementary name implies the path 
to that name. This is done with the “$anchor” keyword to mark the visible names.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.cobol_parser.JSONSchemaMaker.build_json_schema">
<span class="sig-name descname"><span class="pre">build_json_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.cobol_parser.DDE" title="stingray.cobol_parser.DDE"><span class="pre">stingray.cobol_parser.DDE</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_redefines</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.JSONSchemaMaker.build_json_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Emit a JSON schema that reflects a COBOL DDE and all nested DDE’s within it.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.cobol_parser.JSONSchemaMaker.json_type">
<span class="sig-name descname"><span class="pre">json_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.cobol_parser.DDE" title="stingray.cobol_parser.DDE"><span class="pre">stingray.cobol_parser.DDE</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.JSONSchemaMaker.json_type" title="Permalink to this definition">¶</a></dt>
<dd><p>The JSON Schema type for an elementary (or atomic) field.</p>
<p>If we’re using a standad JSON Schema validator (without <code class="docutils literal notranslate"><span class="pre">decimal</span></code> as part of the vocabulary),
the following mappings are used:</p>
<p>COBOL encoded numeric can be <code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:</span> <span class="pre">&quot;string&quot;</span></code> with additional <code class="docutils literal notranslate"><span class="pre">&quot;contentEncoding&quot;</span></code> details.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;contentEncoding&quot;</span></code> describes COBOL Packed Decimal and Binary as strings of bytes.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">&quot;cobol&quot;</span></code> keyword gets Usage and Picture values required to decode EBCDIC.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">&quot;conversion&quot;</span></code> keyword converts to a more useful Python type from raw file strings.</p>
<p>Here’s an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;SOME-FIELD&quot;</span><span class="p">,</span>
 <span class="s2">&quot;$anchor&quot;</span><span class="p">:</span> <span class="s2">&quot;SOME-FIELD&quot;</span><span class="p">,</span>
 <span class="s2">&quot;cobol&quot;</span><span class="p">:</span> <span class="s2">&quot;05 SOME-FIELD USAGE COMP-3 PIC S999V99&quot;</span><span class="p">,</span>

 <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> 
 <span class="s2">&quot;contentEncoding&quot;</span><span class="p">:</span> <span class="s2">&quot;packed-decimal&quot;</span><span class="p">,</span>
 <span class="s2">&quot;conversion&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The title, anchor, and cobol are defined separately. This function provides the 
type, encoding, and conversion.</p>
<p>Other <code class="docutils literal notranslate"><span class="pre">&quot;contentEncoding&quot;</span></code> values include “bigendian-int”.  Also, “bigendian-float” and “bigendian-double”. And, of course, “CP037” or “EBCDIC” to decode ordinary strings from EBCDIC to native text.</p>
<p>If USAGE DISPLAY and PIC has only SVP9: zoned decimal: “type”: “string”, “contentEncoding”: “cp037”, “conversion”: “decimal”,
If USAGE DISPLAY: “string”, “contentEncoding”: “cp037”
If USAGE COMP-3, COMPUTATIONAL-3, PACKED-DECIMAL: “type”: “string”, “contentEncoding”: “packed-decimal”, “conversion”: “decimal”
If USAGE COMP-4, COMPUTATIONAL-4, COMP, COMPUTATIONAL, BINARY: “integer”, “contentEncoding”: “bigendian-int”
If USAGE COMP-1, COMPUTATIONAL-1, COMP-2, COMPUTATIONAL-2: “number”, “contentEncoding”: “bigendian-float” or “bigendian-double”</p>
<dl class="simple">
<dt>TODO: Compute maxLength and minLength from the <code class="docutils literal notranslate"><span class="pre">&quot;contentEncoding&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;cobol&quot;</span></code> fields.</dt><dd><p>Use <code class="xref py py-mod docutils literal notranslate"><span class="pre">estruct</span></code> or <code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code> modules’ <code class="xref py py-mod docutils literal notranslate"><span class="pre">calcsize</span></code>.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.cobol_parser.JSONSchemaMakerExtendedVocabulary">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">JSONSchemaMakerExtendedVocabulary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.cobol_parser.DDE" title="stingray.cobol_parser.DDE"><span class="pre">stingray.cobol_parser.DDE</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.cobol_parser.JSONSchemaMakerExtendedVocabulary" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="stingray.cobol_parser.JSONSchemaMakerExtendedVocabulary.json_type">
<span class="sig-name descname"><span class="pre">json_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.cobol_parser.DDE" title="stingray.cobol_parser.DDE"><span class="pre">stingray.cobol_parser.DDE</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.JSONSchemaMakerExtendedVocabulary.json_type" title="Permalink to this definition">¶</a></dt>
<dd><p>If we’re using an extended vocabulary including  <code class="docutils literal notranslate"><span class="pre">decimal</span></code>, the following mappings can be used.</p>
<p>If USAGE DISPLAY and PIC has only SVP9: zoned “decimal”.
If USAGE DISPLAY: “string”.
If USAGE COMP-3, COMPUTATIONAL-3, PACKED-DECIMAL: “decimal”.
If USAGE COMP-4, COMPUTATIONAL-4, COMP, COMPUTATIONAL, BINARY: “integer”.
If USAGE COMP-1, COMPUTATIONAL-1, COMP-2, COMPUTATIONAL-2: “number”.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">json_type</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
    <span class="s2">&quot;cobol&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">level</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.cobol_parser.clause_dict">
<span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">clause_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.clause_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Expand a COBOL DDE sentence into a dict of clauses and values.
This tends to preserve much (but not all) of the source syntax.</p>
<ol class="arabic simple">
<li><p>Non-space separators (, or ;) are dropped.</p></li>
<li><p>Some productions don’t have all the values captured.
The ASCENDING/DESCENDING KEY options in OCCURS, for example, are stripped away.</p></li>
</ol>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.cobol_parser.dde_sentences">
<span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">dde_sentences</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.dde_sentences" title="Permalink to this definition">¶</a></dt>
<dd><p>Decompose source into separate sentences by looking for the trailing period-space.
The pattern will produce a sequence of (level, source text) 2-tuples.
Since we simply collect all the matching groups, it’s technically a Sequence[str].</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.cobol_parser.expand_repeat">
<span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">expand_repeat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">group_dict</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.expand_repeat" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace {“repeat”: “x(y)”} with {“digit”: “xxx…x”}</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expand_repeat</span><span class="p">({</span><span class="s1">&#39;repeat&#39;</span><span class="p">:</span> <span class="s1">&#39;9(5)&#39;</span><span class="p">})</span>
<span class="go">{&#39;digit&#39;: &#39;99999&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expand_repeat</span><span class="p">({</span><span class="s1">&#39;repeat&#39;</span><span class="p">:</span> <span class="s1">&#39;9(0005)&#39;</span><span class="p">})</span>
<span class="go">{&#39;digit&#39;: &#39;99999&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.cobol_parser.normalize_picture">
<span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">normalize_picture</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.normalize_picture" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse PICTURE clause into component pieces to make it easier to work with.
This breaks down a complex mask into individual pieces.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">normalize_picture</span><span class="p">(</span><span class="s2">&quot;9(5)&quot;</span><span class="p">)</span>
<span class="go">[{&#39;digit&#39;: &#39;99999&#39;}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalize_picture</span><span class="p">(</span><span class="s2">&quot;S9(5)V99&quot;</span><span class="p">)</span>
<span class="go">[{&#39;sign&#39;: &#39;S&#39;}, {&#39;digit&#39;: &#39;99999&#39;}, {&#39;decimal&#39;: &#39;V&#39;}, {&#39;digit&#39;: &#39;99&#39;}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normalize_picture</span><span class="p">(</span><span class="s2">&quot;S9(0005)V9(0002)&quot;</span><span class="p">)</span>
<span class="go">[{&#39;sign&#39;: &#39;S&#39;}, {&#39;digit&#39;: &#39;99999&#39;}, {&#39;decimal&#39;: &#39;V&#39;}, {&#39;digit&#39;: &#39;99&#39;}]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.cobol_parser.pass_non_empty">
<span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">pass_non_empty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">group_dict</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.pass_non_empty" title="Permalink to this definition">¶</a></dt>
<dd><p>Pass dictionary items with non-empty values; reject items with empty values.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pass_non_empty</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;empty&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="go">{&#39;a&#39;: &#39;b&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.cobol_parser.reference_format">
<span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">reference_format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">TextIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replacing</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.reference_format" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract source from files that have sequence numbers in 1-6, indicator in 7, and code in 8-72.
Zero-based, these slices are [0:6], [6], [7:72]</p>
<p>This can be extended to handle COPY statements that include other copybooks into a copybook.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">replacing</span></code> parameter is a list of (“‘old’”, “new”) strings to replace in the source
The apostrophes on the old are required here.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.cobol_parser.structure">
<span class="sig-prename descclassname"><span class="pre">stingray.cobol_parser.</span></span><span class="sig-name descname"><span class="pre">structure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sentences</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.cobol_parser.DDE" title="stingray.cobol_parser.DDE"><span class="pre">stingray.cobol_parser.DDE</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.cobol_parser.structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a list of DDE trees from a sequence of lines.
Each DDE contains zero or more children.</p>
<p>We update the start of a REDEFINES union.
We don’t know X will be redefined until we encounter “Y REDEFINES X”.</p>
<p>The sentence regular expression produces two-tuples. Since we use
the simple groups() function, however, it’s technically a Sequence[str].</p>
</dd></dl>

</section>
</section>
<section id="module-stingray.workbook">
<span id="workbook-access"></span><h2>Workbook Access<a class="headerlink" href="#module-stingray.workbook" title="Permalink to this headline">¶</a></h2>
<p>Row, Sheet, and Workbook Definitions.</p>
<p>The Stingray Reader treats all workbooks alike. This means wrapping CSV files, Numbers_13, ODS, and XLSX files so they have a uniform “workbook” interface.</p>
<p>The idea is to have a <strong>Facade</strong> of <a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><code class="xref py py-class docutils literal notranslate"><span class="pre">Workbook</span></code></a>, <a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sheet</span></code></a>, and <a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> that describe all of these file formats.
The definitions are mostly protocols to handle non-delimited (i.e., COBOL files), delimited files, and workbooks.</p>
<p>This depends on the lower-level <code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Instance</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Nav</span></code>, and <code class="xref py py-class docutils literal notranslate"><span class="pre">Location</span></code> constructs.</p>
<p>This includes the following built-in workbook formats:</p>
<ul class="simple">
<li><p>CSV via built-in <code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code> module.</p></li>
<li><p>NDJSON a/k/a JSON Newline via the built-in <code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code> module.</p></li>
<li><p>COBOL via the <a class="reference internal" href="#module-stingray.estruct" title="stingray.estruct"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stingray.estruct</span></code></a> module.</p></li>
</ul>
<p>Here are some additional side-bar considerations for other formats that depend on external modules.</p>
<ul class="simple">
<li><p>CSV is built-in. We permit kwargs to provide additional dialect details.</p></li>
<li><p>JSON is built-in.  We’ll treate newline delimited JSON like CSV.</p></li>
<li><p>XLS is a weird proprietary thing. The <code class="docutils literal notranslate"><span class="pre">xlrd</span></code> project (<a class="reference external" href="https://pypi.org/project/xlrd/">https://pypi.org/project/xlrd/</a>) supports it.</p></li>
<li><p>ODS and XLSX are XML files. Incremental parsing is helpful here because they can be large. See <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/">https://openpyxl.readthedocs.io/en/stable/</a> and <a class="reference external" href="http://docs.pyexcel.org/en/v0.0.6-rc2/">http://docs.pyexcel.org/en/v0.0.6-rc2/</a>.</p></li>
<li><p>Numbers_13 is protobuf. The legacy version of Stingray Reader had  protobuf definitions which appear to work and a snappy decoder. See <a class="reference external" href="https://pypi.org/project/numbers-parser/">https://pypi.org/project/numbers-parser/</a> for a better solution.</p></li>
<li><p>TOML requires an external library.  An <cite>Unpacker</cite> subclass can decompose a “one big list” TOML document into individual rows.</p></li>
<li><p>YAML requires an external library. We’ll use the iterative parser as a default. An <cite>Unpacker</cite> subclass can decompose a “one big list” YAML document into individual rows.</p></li>
<li><p>XML is built-in. A schema can drive navgiation through the XML document, name the various tags of interest. Other tags which may be present would be ignored.</p></li>
</ul>
<p>A given workbook has two possible sources for a schema: internal and external. An internal schema might be the first row or it might require more sophisticated parsing. An external schema might be hard-coded in the application, or might be a separate document with its own meta-schema.</p>
<p>Generally, the schema applies to a sheet (or a Table in a Workspace for Numbers.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@startuml</span>
    <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Schema</span>
    <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Unpacker</span>
    <span class="k">class</span> <span class="nc">Location</span>
    <span class="n">Location</span> <span class="o">--&gt;</span> <span class="n">Schema</span>
    <span class="s1">&#39;abstract class NDInstance</span>
    <span class="s1">&#39;Location -&gt; NDInstance</span>
    <span class="k">class</span> <span class="nc">LocationMaker</span> <span class="p">{</span>
        <span class="n">from_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span> <span class="n">Location</span>
    <span class="p">}</span>
    <span class="n">Unpacker</span> <span class="o">--&gt;</span> <span class="n">LocationMaker</span>
    <span class="n">LocationMaker</span> <span class="o">--&gt;</span> <span class="s2">&quot;n&quot;</span> <span class="n">Location</span> <span class="p">:</span> <span class="n">creates</span>
    <span class="o">/</span><span class="s1">&#39;Details...</span>
    <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Nav</span>
    <span class="k">class</span> <span class="nc">NDNav</span>
    <span class="k">class</span> <span class="nc">DNav</span>
    <span class="k">class</span> <span class="nc">WBNav</span>
    <span class="n">Nav</span> <span class="o">&lt;|--</span> <span class="n">NDNav</span>
    <span class="n">Nav</span> <span class="o">&lt;|--</span> <span class="n">DNav</span>
    <span class="n">Nav</span> <span class="o">&lt;|--</span> <span class="n">WBNav</span>

    <span class="n">Unpacker</span> <span class="o">--&gt;</span> <span class="n">NDNav</span> <span class="p">:</span> <span class="n">creates</span>
    <span class="n">Unpacker</span> <span class="o">--&gt;</span> <span class="n">DNav</span> <span class="p">:</span> <span class="n">creates</span>

    <span class="n">NDNav</span> <span class="o">--&gt;</span> <span class="n">Location</span>

    <span class="k">class</span> <span class="nc">JSON</span>
    <span class="n">DNav</span> <span class="o">--&gt;</span> <span class="n">JSON</span>
    <span class="s1">&#39;/</span>

    <span class="k">class</span> <span class="nc">File</span>
    <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Workbook</span> <span class="c1">##[bold]blue</span>

    <span class="n">Workbook</span> <span class="o">--&gt;</span> <span class="n">Unpacker</span>
    <span class="n">Workbook</span> <span class="o">--&gt;</span> <span class="n">File</span> <span class="p">:</span> <span class="n">opens</span>
    <span class="n">Unpacker</span> <span class="o">--&gt;</span> <span class="n">File</span> <span class="p">:</span> <span class="n">reads</span>

    <span class="k">class</span> <span class="nc">Sheet</span> <span class="c1">##[bold]blue {</span>
        <span class="n">row_iter</span><span class="p">():</span> <span class="n">Row</span>
    <span class="p">}</span>
    <span class="n">Workbook</span> <span class="o">*--</span> <span class="s2">&quot;1:n&quot;</span> <span class="n">Sheet</span>
    <span class="n">Sheet</span> <span class="o">--&gt;</span> <span class="n">Schema</span>
    <span class="k">class</span> <span class="nc">Row</span>  <span class="c1">##[bold]blue {</span>
        <span class="n">name</span><span class="p">():</span> <span class="n">Any</span>
    <span class="p">}</span>
    <span class="n">Sheet</span> <span class="o">*--</span> <span class="s2">&quot;n&quot;</span> <span class="n">Row</span>
    <span class="n">Row</span> <span class="o">--&gt;</span> <span class="n">NDNav</span> <span class="p">:</span> <span class="s2">&quot;[non-delimited]&quot;</span>
    <span class="n">Row</span> <span class="o">--&gt;</span> <span class="n">DNav</span> <span class="p">:</span> <span class="s2">&quot;[delimited]&quot;</span>
    <span class="n">Row</span> <span class="o">--&gt;</span> <span class="n">WBNav</span> <span class="p">:</span> <span class="s2">&quot;[workbook]&quot;</span>
    <span class="k">class</span> <span class="nc">EmbeddedSchemaSheet</span>
    <span class="k">class</span> <span class="nc">ExternalSchemaSheet</span>
    <span class="n">Sheet</span> <span class="o">&lt;|--</span> <span class="n">EmbeddedSchemaSheet</span>
    <span class="n">Sheet</span> <span class="o">&lt;|--</span> <span class="n">ExternalSchemaSheet</span>
    <span class="k">class</span> <span class="nc">SchemaLoader</span>
    <span class="n">EmbeddedSchemaSheet</span> <span class="o">--&gt;</span> <span class="n">SchemaLoader</span>
    <span class="n">ExternalSchemaSheet</span> <span class="o">--&gt;</span> <span class="n">SchemaLoader</span>
    <span class="n">SchemaLoader</span> <span class="o">--&gt;</span> <span class="n">Schema</span> <span class="p">:</span> <span class="n">creates</span>
<span class="nd">@enduml</span>
</pre></div>
</div>
<section id="legacy-api-concept">
<h3>Legacy API Concept<a class="headerlink" href="#legacy-api-concept" title="Permalink to this headline">¶</a></h3>
<p>The original concept for the API looked like this:</p>
<p><strong>Internal, Embedded Schema</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stingray.workbook</span> <span class="kn">import</span> <span class="n">open_workbook</span><span class="p">,</span> <span class="n">EmbeddedSchemaSheet</span><span class="p">,</span> <span class="n">HeadingRowSchemaLoader</span>

<span class="k">with</span> <span class="n">open_workbook</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">workbook</span><span class="p">:</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">EmbeddedSchemaSheet</span><span class="p">(</span><span class="n">workbook</span><span class="p">,</span> <span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span> <span class="n">HeadingRowSchemaLoader</span><span class="p">)</span>
    <span class="n">process_sheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>External Schema</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stingray.workbook</span> <span class="kn">import</span> <span class="n">open_workbook</span><span class="p">,</span> <span class="n">ExternalSchemaSheet</span><span class="p">,</span> <span class="n">ExternalSchemaLoader</span>

<span class="k">with</span> <span class="n">open_workbook</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_wb</span><span class="p">:</span>
    <span class="n">esl</span> <span class="o">=</span> <span class="n">ExternalSchemaLoader</span><span class="p">(</span><span class="n">schema_wb</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Schema&#39;</span><span class="p">)</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">esl</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="k">with</span> <span class="n">open_workbook</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">workbook</span><span class="p">:</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">ExternalSchemaSheet</span><span class="p">(</span><span class="n">workbook</span><span class="p">,</span> <span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
    <span class="n">process_sheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
</pre></div>
</div>
<p>If necessary, the external schema can have a meta-schema. It may be necessary to define a conversion function to create a useful JSON Schema from a schema workbook.</p>
<p>COBOL, External Schema</p>
<p>For COBOL, there were <cite>TextFile</cite> and a <cite>EBCDICFile</cite> subclasses of <cite>Workbook</cite>.</p>
</section>
<section id="api-concept">
<h3>API Concept<a class="headerlink" href="#api-concept" title="Permalink to this headline">¶</a></h3>
<p>A “fluent” interface is used to open a sheet, extract a header, and process rows. The alternative is to open a sheet, apply the externally loaded schema, and use this to process the sheet’s rows.
Once a sheet has been bound to a schema, the rows can be processed.</p>
<p><strong>Internal, Embedded Schema</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stingray</span> <span class="kn">import</span> <span class="n">open_workbook</span><span class="p">,</span> <span class="n">HeadingRowSchemaLoader</span><span class="p">,</span> <span class="n">Row</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SAMPLES&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="s2">&quot;Anscombe_quartet_data.csv&quot;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">process_sheet</span><span class="p">(</span><span class="n">rows</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Row</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">row</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
<span class="gp">... </span>        <span class="k">break</span>  <span class="c1"># Stop after 1 row.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">open_workbook</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">workbook</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span>
<span class="gp">... </span>   <span class="n">_</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">set_schema_loader</span><span class="p">(</span><span class="n">HeadingRowSchemaLoader</span><span class="p">())</span>
<span class="gp">... </span>   <span class="n">process_sheet</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">())</span>
<span class="go">Field                                                 Value</span>
<span class="go">object</span>
<span class="go">  x123                                                &#39;10.0&#39;</span>
<span class="go">  y1                                                  &#39;8.04&#39;</span>
<span class="go">  y2                                                  &#39;9.14&#39;</span>
<span class="go">  y3                                                  &#39;7.46&#39;</span>
<span class="go">  x4                                                  &#39;8.0&#39;</span>
<span class="go">  y4                                                  &#39;6.58&#39;</span>
</pre></div>
</div>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">rows()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Sheet</span></code> will exclude the header rows consumed
by the <code class="docutils literal notranslate"><span class="pre">HeadingRowSchemaLoader</span></code>.</p>
<p><strong>External Schema</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stingray</span> <span class="kn">import</span> <span class="n">open_workbook</span><span class="p">,</span> <span class="n">HeadingRowSchemaLoader</span><span class="p">,</span> <span class="n">Row</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SAMPLES&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="s2">&quot;Anscombe_quartet_data.csv&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SAMPLES&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="s2">&quot;Anscombe_schema.csv&quot;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">open_workbook</span><span class="p">(</span><span class="n">schema_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">metaschema_workbook</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">schema_sheet</span> <span class="o">=</span> <span class="n">metaschema_workbook</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">schema_sheet</span><span class="o">.</span><span class="n">set_schema</span><span class="p">(</span><span class="n">SchemaMaker</span><span class="p">()</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">ExternalSchemaLoader</span><span class="o">.</span><span class="n">META_SCHEMA</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">json_schema</span> <span class="o">=</span> <span class="n">ExternalSchemaLoader</span><span class="p">(</span><span class="n">schema_sheet</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">schema</span> <span class="o">=</span> <span class="n">SchemaMaker</span><span class="p">()</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_schema</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">open_workbook</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">workbook</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">process_sheet</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">())</span>
<span class="go">Field                                                 Value</span>
<span class="go">object</span>
<span class="go">  x123                                                &#39;x123&#39;</span>
<span class="go">  y1                                                  &#39;y1&#39;</span>
<span class="go">  y2                                                  &#39;y2&#39;</span>
<span class="go">  y3                                                  &#39;y3&#39;</span>
<span class="go">  x4                                                  &#39;x4&#39;</span>
<span class="go">  y4                                                  &#39;y4&#39;</span>
</pre></div>
</div>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">rows()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Sheet</span></code> will include all rows.
This means the header row is treated like data when an external schema is applied.</p>
<p>The <strong>process_sheet()</strong> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_sheet</span><span class="p">(</span><span class="n">rows</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Row</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s2">&quot;field&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">name()</span></code> method returns a <code class="docutils literal notranslate"><span class="pre">Nav</span></code> object. This has a <code class="docutils literal notranslate"><span class="pre">value()</span></code> method that will extract the value
for a given attribute.</p>
<section id="sheet-and-row">
<h4>Sheet and Row<a class="headerlink" href="#sheet-and-row" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sheet</span></code></a> class contained metadata about the sheet, and a row iterator.
It’s generally used like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_sheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">:</span> <span class="n">Sheet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">():</span>
        <span class="n">process_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>A <a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> contains an instance that’s bound to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Unpacker</span></code> and the <code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code>.
This will build <code class="xref py py-class docutils literal notranslate"><span class="pre">Nav</span></code> objects for navigation. Where necessary, this may involve creating
<code class="xref py py-class docutils literal notranslate"><span class="pre">Location</span></code> objects as part of <code class="xref py py-class docutils literal notranslate"><span class="pre">NDNav</span></code> navigation.</p>
</section>
</section>
<section id="formats-handled-here">
<h3>Formats Handled Here<a class="headerlink" href="#formats-handled-here" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>.CSV</p></li>
<li><p>NDJSON</p></li>
<li><p>COBOL in native Text</p></li>
<li><p>COBOL in EBCDIC</p></li>
<li><p>.TAB file via CSV reader with dialetc options</p></li>
<li><p>Pure Text via External Schema.
See <code class="docutils literal notranslate"><span class="pre">workbook.simple</span></code> and the metadata in <code class="docutils literal notranslate"><span class="pre">simple.csv</span></code>.</p></li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.COBOLSchemaLoader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">COBOLSchemaLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pathlib.Path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.COBOLSchemaLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>The most common case is a single COBOL Schema.
For other, more complex situations, the single schema assumption may not be appropriate.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.COBOL_EBCDIC_File">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">COBOL_EBCDIC_File</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_object</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">IO</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recfm_class</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.estruct.RECFM_Reader" title="stingray.estruct.RECFM_Reader"><span class="pre">stingray.estruct.RECFM_Reader</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lrecl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.COBOL_EBCDIC_File" title="Permalink to this definition">¶</a></dt>
<dd><p>EBCDIC-encoded files. No newline delimiters are used.</p>
<p>The NDInstance is AnyStr, which is a union of str | bytes.
This is narrower than that, and could be bytes only, not NDInstance.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.COBOL_EBCDIC_Sheet">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">COBOL_EBCDIC_Sheet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">workbook</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sheet_name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.COBOL_EBCDIC_Sheet" title="Permalink to this definition">¶</a></dt>
<dd><p>The single “Sheet” in a file. This is a container for the rows.
It handles the RECFM and LRECL complexities of variable-length non-delimited records.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.COBOL_EBCDIC_Sheet.row_iter">
<span class="sig-name descname"><span class="pre">row_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><span class="pre">stingray.workbook.Row</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.COBOL_EBCDIC_Sheet.row_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Passes instances through the schema loader.  (An external schema will have a dummy loader.)
Extracts a schema from the header.
Applies the schema to the body to create a <a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> instances.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.COBOL_EBCDIC_Sheet.rows">
<span class="sig-name descname"><span class="pre">rows</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><span class="pre">stingray.workbook.Row</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.COBOL_EBCDIC_Sheet.rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Passes instances through the schema loader.  (An external schema will have a dummy loader.)
Extracts a schema from the header.
Applies the schema to the body to create a <a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> instances.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.COBOL_EBCDIC_Sheet.set_schema">
<span class="sig-name descname"><span class="pre">set_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><span class="pre">stingray.workbook.Sheet</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.COBOL_EBCDIC_Sheet.set_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Done eagerly to make the LRECL more visible.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.COBOL_Text_File">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">COBOL_Text_File</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_object</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">IO</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.COBOL_Text_File" title="Permalink to this definition">¶</a></dt>
<dd><p>Text Files in a fixed format. Newline delimited.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.CSVUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">CSVUnpacker</span></span><a class="headerlink" href="#stingray.workbook.CSVUnpacker" title="Permalink to this definition">¶</a></dt>
<dd><p>Upacker that wraps the <code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code> module.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.CSV_Workbook">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">CSV_Workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_object</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">IO</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.CSV_Workbook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.ExternalSchemaLoader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">ExternalSchemaLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sheet</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><span class="pre">stingray.workbook.Sheet</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.ExternalSchemaLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an external source of data to prepare a schema.</p>
<p>A default schema for extrnal metadata is ExternalSchemaLoader.META_SCHEMA.
The odds of this being correct are low.</p>
<p>A subclass can do more sophisticated parsing of complex metadata.
For example, COBOL DDE parsing, is an example of complex schema loading.</p>
<p>A subclass could also read JSONSchema directly, if that’s available.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.HeadingRowSchemaLoader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">HeadingRowSchemaLoader</span></span><a class="headerlink" href="#stingray.workbook.HeadingRowSchemaLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a schema from the first row of a workbook sheet.
The “Instance” is expected to be a WBInstance, which is a Sequence of column values,
parsed by a WBUnpacker.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.HeadingRowSchemaLoader.header">
<span class="sig-name descname"><span class="pre">header</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.HeadingRowSchemaLoader.header" title="Permalink to this definition">¶</a></dt>
<dd><p>Consume the first row or rows to build a schema.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.JSONUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">JSONUnpacker</span></span><a class="headerlink" href="#stingray.workbook.JSONUnpacker" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpacker that wraps the <code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code> module..</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.JSON_Workbook">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">JSON_Workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_object</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">IO</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.JSON_Workbook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.Row">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">Row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sheet</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><span class="pre">stingray.workbook.Sheet</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">stingray.schema_instance.Instance</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.Row" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper around a <code class="xref py py-class docutils literal notranslate"><span class="pre">Nav</span></code> object bound to an <code class="xref py py-class docutils literal notranslate"><span class="pre">Instance</span></code>.</p>
<p>Note that both Instance and Sheet have the schema. While can be excessive,
it’s also possible the sheet suffers from many schema and the assignment
is on an instance-by-instance basis.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.SchemaLoader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">SchemaLoader</span></span><a class="headerlink" href="#stingray.workbook.SchemaLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a schema.</p>
<p>There are two cases:</p>
<ul class="simple">
<li><p>External schema from other files.</p></li>
<li><p>Internal schema. This is often the top row of a sheet. However, some workbooks will
have elaborate headers. Some have footers that must also be excluded.</p></li>
</ul>
<p>This superclass is a “dummy” that does nothing. This is used when an external
schema has been bound to a <a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sheet</span></code></a> and no futher processing is
required. For example, when processing COBOL files where the schema is separate.</p>
<p>A schema is returned as a JSONSchema document.
This is almost always converted to a <code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code> instance.
If, however, changes need to be made, or the schema is used outside this module,
it’s already in a standard format.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.SchemaLoader.body">
<span class="sig-name descname"><span class="pre">body</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.SchemaLoader.body" title="Permalink to this definition">¶</a></dt>
<dd><p>Consume the non-header rows, applying an additional filter criteria.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.SchemaLoader.header">
<span class="sig-name descname"><span class="pre">header</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">typing.Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.SchemaLoader.header" title="Permalink to this definition">¶</a></dt>
<dd><p>Consume the first row or rows to build a schema.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.Sheet">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">Sheet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">workbook</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sheet_name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.Sheet" title="Permalink to this definition">¶</a></dt>
<dd><p>A Sheet of a Workbook. This can also be a table on a page of a Numbers workbook.</p>
<p>It needs a schema binding to describe the content of each row.</p>
<p>Either a Schema is loaded from an external source.
OR an internal Schema loader is used to extract a schema from the first few rows of the sheet.</p>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.Sheet.row_iter">
<span class="sig-name descname"><span class="pre">row_iter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><span class="pre">stingray.workbook.Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.Sheet.row_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Passes instances through the schema loader.  (An external schema will have a dummy loader.)
Extracts a schema from the header.
Applies the schema to the body to create a <a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> instances.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.Sheet.rows">
<span class="sig-name descname"><span class="pre">rows</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><span class="pre">stingray.workbook.Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.Sheet.rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Passes instances through the schema loader.  (An external schema will have a dummy loader.)
Extracts a schema from the header.
Applies the schema to the body to create a <a class="reference internal" href="#stingray.workbook.Row" title="stingray.workbook.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> instances.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.Sheet.set_schema">
<span class="sig-name descname"><span class="pre">set_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.schema_instance.Schema" title="stingray.schema_instance.Schema"><span class="pre">stingray.schema_instance.Schema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><span class="pre">stingray.workbook.Sheet</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.Sheet.set_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides an externally-supplied schema.</p>
<p>This also sets a “do nothing” schema loader</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.Sheet.set_schema_loader">
<span class="sig-name descname"><span class="pre">set_schema_loader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loader</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#stingray.workbook.SchemaLoader" title="stingray.workbook.SchemaLoader"><span class="pre">stingray.workbook.SchemaLoader</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#stingray.workbook.Sheet" title="stingray.workbook.Sheet"><span class="pre">stingray.workbook.Sheet</span></a><span class="p"><span class="pre">[</span></span><span class="pre">stingray.schema_instance.Instance</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.Sheet.set_schema_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>A SchemaLoader that builds a schema by extracting some of the Instances.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.WBFileRegistry">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">WBFileRegistry</span></span><a class="headerlink" href="#stingray.workbook.WBFileRegistry" title="Permalink to this definition">¶</a></dt>
<dd><p>A global registry for Workbook classes and their associated file suffixes.
It makes an open_workbook() function that can open a wide variety of file types.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">file_registry</span> <span class="o">=</span> <span class="n">WBFileRegistry</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@file_registry</span><span class="o">.</span><span class="n">file_suffix</span><span class="p">(</span><span class="s2">&quot;.xyz&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">XYZ_Workbook</span><span class="p">(</span><span class="n">Workbook</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_registry</span><span class="o">.</span><span class="n">suffix_map</span><span class="p">[</span><span class="s2">&quot;.xyz&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">XYZ_Workbook</span>
<span class="go">True</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="stingray.workbook.WBFileRegistry.open_workbook">
<span class="sig-name descname"><span class="pre">open_workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pathlib.Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.WBInstance" title="stingray.schema_instance.WBInstance"><span class="pre">stingray.schema_instance.WBInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.DInstance" title="stingray.schema_instance.DInstance"><span class="pre">stingray.schema_instance.DInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.WBFileRegistry.open_workbook" title="Permalink to this definition">¶</a></dt>
<dd><p>Opens an appropriate subclass of Workbook for the given file.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.workbook.Workbook">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">Workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.workbook.Workbook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.workbook.name_cleaner">
<span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">name_cleaner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#stingray.workbook.name_cleaner" title="Permalink to this definition">¶</a></dt>
<dd><p>JSON Schema names for anchors and properties are validated
against patterns defined in places like core/$defs/anchorString.</p>
<p>Anchor names must match the following pattern.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z_][-A-Za-z0-9._]*$&quot;</span>
</pre></div>
</div>
<p>This function replaces illegal characters with “_”</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">name_cleaner</span><span class="p">(</span><span class="s2">&quot;TYPICAL-COBOL&quot;</span><span class="p">)</span>
<span class="go">&#39;TYPICAL-COBOL&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_cleaner</span><span class="p">(</span><span class="s2">&quot;common_python&quot;</span><span class="p">)</span>
<span class="go">&#39;common_python&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_cleaner</span><span class="p">(</span><span class="s2">&quot;Not a &#39;good&#39; name&quot;</span><span class="p">)</span>
<span class="go">&#39;Not_a_good_name&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_cleaner</span><span class="p">(</span><span class="s2">&quot;!@#$%^&quot;</span><span class="p">)</span>
<span class="go">&#39;_&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_cleaner</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="go">&#39;&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stingray.workbook.open_workbook">
<span class="sig-prename descclassname"><span class="pre">stingray.workbook.</span></span><span class="sig-name descname"><span class="pre">open_workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pathlib.Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.NDInstance" title="stingray.schema_instance.NDInstance"><span class="pre">stingray.schema_instance.NDInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.WBInstance" title="stingray.schema_instance.WBInstance"><span class="pre">stingray.schema_instance.WBInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><a class="reference internal" href="#stingray.workbook.Workbook" title="stingray.workbook.Workbook"><span class="pre">stingray.workbook.Workbook</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#stingray.schema_instance.DInstance" title="stingray.schema_instance.DInstance"><span class="pre">stingray.schema_instance.DInstance</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#stingray.workbook.open_workbook" title="Permalink to this definition">¶</a></dt>
<dd><p>CSV Implementation</p>
</dd></dl>

</section>
</section>
<section id="module-stingray.implementations">
<span id="workbook-implementations"></span><h2>Workbook Implementations<a class="headerlink" href="#module-stingray.implementations" title="Permalink to this headline">¶</a></h2>
<p>Workbook Implementations</p>
<p>See <a class="reference external" href="http://www.python-excel.org/">http://www.python-excel.org/</a> for a complete list of implementations.
Of these, we choose a few to handle XLSX, ODS, and Numbers.</p>
<section id="xls-files-via-xlrd">
<h3>.XLS files via <code class="docutils literal notranslate"><span class="pre">xlrd</span></code><a class="headerlink" href="#xls-files-via-xlrd" title="Permalink to this headline">¶</a></h3>
<p>Note that this is <em>only</em> for historical .XLS files.</p>
<p>See <a class="reference external" href="https://xlrd.readthedocs.io/en/latest/">https://xlrd.readthedocs.io/en/latest/</a></p>
</section>
<section id="xlsx-files-via-openpyxl">
<h3>.XLSX files via <code class="docutils literal notranslate"><span class="pre">Openpyxl</span></code><a class="headerlink" href="#xlsx-files-via-openpyxl" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/">https://openpyxl.readthedocs.io/en/stable/</a></p>
</section>
<section id="ods-files-via-pyexcel">
<h3>.ODS files via Pyexcel<a class="headerlink" href="#ods-files-via-pyexcel" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="http://docs.pyexcel.org/en/latest/">http://docs.pyexcel.org/en/latest/</a></p>
<p>See <a class="reference external" href="https://github.com/pyexcel/pyexcel-ods3">https://github.com/pyexcel/pyexcel-ods3</a></p>
<p>Generally, Pyexcel seems to cover the widest variety of formats.
It might be helpful to delegate more of the implementations to PyExcel.</p>
</section>
<section id="numbers-13-files-via">
<h3>.NUMBERS 13 files via ??<a class="headerlink" href="#numbers-13-files-via" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://pypi.org/project/numbers-parser/">https://pypi.org/project/numbers-parser/</a></p>
<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.NumbersUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">NumbersUnpacker</span></span><a class="headerlink" href="#stingray.implementations.NumbersUnpacker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.Numbers_Workbook">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">Numbers_Workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.implementations.Numbers_Workbook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.ODSUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">ODSUnpacker</span></span><a class="headerlink" href="#stingray.implementations.ODSUnpacker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.ODS_Workbook">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">ODS_Workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.implementations.ODS_Workbook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.XLSUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">XLSUnpacker</span></span><a class="headerlink" href="#stingray.implementations.XLSUnpacker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.XLSXUnpacker">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">XLSXUnpacker</span></span><a class="headerlink" href="#stingray.implementations.XLSXUnpacker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.XLSX_Workbook">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">XLSX_Workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.implementations.XLSX_Workbook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stingray.implementations.XLS_Workbook">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stingray.implementations.</span></span><span class="sig-name descname"><span class="pre">XLS_Workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stingray.implementations.XLS_Workbook" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/Stingray_belon1553_small.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Stingray-Reader</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Using <strong>Stingray Reader</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/index.html">Demo Applications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Commercial Use</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../demo/conversion.html" title="previous chapter">Data Conversion – ETL with Validation</a></li>
      <li>Next: <a href="../history.html" title="next chapter">History</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, S.Lott.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/implementation/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>