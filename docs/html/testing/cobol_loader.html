
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>14.8. COBOL Schema Loader Unit Tests &#8212; The Stingray Schema-Based File Reader</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="14.9. COBOL Integration Tests" href="cobol_2.html" />
    <link rel="prev" title="14.7. COBOL Schema Testing" href="cobol.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="cobol-schema-loader-unit-tests">
<h1>14.8. COBOL Schema Loader Unit Tests<a class="headerlink" href="#cobol-schema-loader-unit-tests" title="Permalink to this headline">¶</a></h1>
<p>These are unit tests of various parts of the COBOL schema loader.  See <a class="reference internal" href="../cobol_loader.html#cobol-loader"><span class="std std-ref">COBOL Loader Module – Parse COBOL Source to Load a Schema</span></a>.</p>
<div class="section" id="overheads">
<h2>14.8.1. Overheads<a class="headerlink" href="#overheads" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;stingray.cobol.loader Unit Tests.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">stingray.cobol.loader</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">io</span>
</pre></div>
</div>
</div>
<div class="section" id="lexical-scanner">
<h2>14.8.2. Lexical Scanner<a class="headerlink" href="#lexical-scanner" title="Permalink to this headline">¶</a></h2>
<p>At a low-level, a parser requires a lexical scanner to break the input into
discrete tokens.  In the case of COBOL, there are mercifully few rules to
follow.</p>
<p>A few test cases will demonstrate that line-ending <code class="docutils literal notranslate"><span class="pre">.</span></code> as well as
a simple version of COBOL quoting rules are followed.  The full COBOL language
isn’t being parsed, just the part of the language used for DDE’s.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestLexicalScanner</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_should_scan</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy1</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">      * COPY1.COB</span>
<span class="s2">       01  DETAIL-LINE.</span>
<span class="s2">           05                              PIC X(7).</span>
<span class="s2">           05  QUESTION                    PIC ZZ.</span>
<span class="s2">           05                              PIC X(6).</span>
<span class="s2">           05  PRINT-YES                   PIC ZZ.</span>
<span class="s2">           05                              PIC X(3).</span>
<span class="s2">         SKIP2</span>
<span class="s2">           05  PRINT-NO                    PIC ZZ.</span>
<span class="s2">           05                              PIC X(6).</span>
<span class="s2">           05  NOT-SURE                    PIC ZZ.</span>
<span class="s2">           05                              PIC X(7).</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;DETAIL-LINE&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(7)&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;QUESTION&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(6)&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PRINT-YES&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(3)&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PRINT-NO&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(6)&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;NOT-SURE&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(7)&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy1</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_scan_pic</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy2</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">      * COPY2.COB</span>
<span class="s2">       01  DETAIL-LINE.</span>
<span class="s2">           05  FANCY-FORMAT                PIC 9(7).99.</span>
<span class="s2">           05  SSN-FORMAT                  PIC 999-99-9999.</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;DETAIL-LINE&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;FANCY-FORMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;9(7).99&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;SSN-FORMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;999-99-9999&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy2</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_scan_quotes</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy3</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">      * COPY3.COB</span>
<span class="s2">       01  SIMPLE-LINE.</span>
<span class="s2">           05  VALUE-1                PIC X(10) VALUE &#39;STRING    &#39;.</span>
<span class="s2">           05  VALUE-2                PIC X(10) VALUE &quot;STRING    &quot;.</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;SIMPLE-LINE&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;VALUE-1&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;STRING    &#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;VALUE-2&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;STRING    &quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy3</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_replace_text</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy4</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">      * COPY4.COB</span>
<span class="s2">       01  &#39;XY&#39;-SIMPLE-LINE.</span>
<span class="s2">           05  &#39;XY&#39;-VALUE-1                PIC X(10) VALUE &#39;STRING    &#39;.</span>
<span class="s2">           05  &#39;XY&#39;-VALUE-2                PIC X(10) VALUE &quot;STRING    &quot;.</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;AB-SIMPLE-LINE&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;AB-VALUE-1&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;STRING    &#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;AB-VALUE-2&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;STRING    &quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">(</span><span class="n">replacing</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;&#39;XY&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;AB&quot;</span><span class="p">)])</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy4</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="long-lexical-scanner">
<h2>14.8.3. Long Lexical Scanner<a class="headerlink" href="#long-lexical-scanner" title="Permalink to this headline">¶</a></h2>
<p>Some copybooks have junk at the left and right on each line of source.
A separate subclass can handle this.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestLongLexicalScanner</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy1</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">      **************************************************************</span>
<span class="s2">       01  REPORT-TAPE-DETAIL-RECORD.</span>
<span class="s2">           02  RDT-REC-CODE-BYTES.                                      00000130</span>
<span class="s2">       EJECT</span>
<span class="s2">               03  RDT-REC-CODE-KEY              PIC X.                 00000140</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer_Long_Lines</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy1</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_scan</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORT-TAPE-DETAIL-RECORD&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;02&#39;</span><span class="p">,</span> <span class="s1">&#39;RDT-REC-CODE-BYTES&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;03&#39;</span><span class="p">,</span> <span class="s1">&#39;RDT-REC-CODE-KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="picture-parsing">
<h2>14.8.4. Picture Parsing<a class="headerlink" href="#picture-parsing" title="Permalink to this headline">¶</a></h2>
<p>A picture clause has it’s own “sub-language” for describing an elementary
piece of data.  From the picture clause, we extract a number of features.</p>
<dl class="attribute">
<dt id="final">
<code class="descname">final</code><a class="headerlink" href="#final" title="Permalink to this definition">¶</a></dt>
<dt>
<code class="descname">final picture with ()'s expanded.</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="alpha">
<code class="descname">alpha</code><a class="headerlink" href="#alpha" title="Permalink to this definition">¶</a></dt>
<dt>
<code class="descname">boolean alpha = True, numeric = False.</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="length">
<code class="descname">length</code><a class="headerlink" href="#length" title="Permalink to this definition">¶</a></dt>
<dt id="len">
<code class="descname">len</code><span class="sig-paren">(</span><em>final</em><span class="sig-paren">)</span><a class="headerlink" href="#len" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="scale">
<code class="descname">scale</code><a class="headerlink" href="#scale" title="Permalink to this definition">¶</a></dt>
<dt>
<code class="descname">count of &quot;P&quot; positions</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="precision">
<code class="descname">precision</code><a class="headerlink" href="#precision" title="Permalink to this definition">¶</a></dt>
<dt>
<code class="descname">digits to the right of the decimal point</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="signed">
<code class="descname">signed</code><a class="headerlink" href="#signed" title="Permalink to this definition">¶</a></dt>
<dt id="boolean">
<code class="descname">boolean</code><a class="headerlink" href="#boolean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="decimal">
<code class="descname">decimal</code><a class="headerlink" href="#decimal" title="Permalink to this definition">¶</a></dt>
<dt>
<code class="descname">&quot;.&quot; or &quot;V&quot; or None</code></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestPictureParser</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_should_expand</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;X(7)&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;XXXXXXX&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_z</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;ZZ&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;ZZ&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_9</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;999&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_complex</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;9(5)V99&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;9999999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_signed</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;S9(7)V99&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;999999999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_db</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;DB9(5).99&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;DB99999.99&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_signed_and_v</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;S9(4)V&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;9999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_multiple_repeats</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s2">&quot;9(6).9(3)&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;999999.999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_trailing_repeat_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span><span class="s2">&quot;SV9(5)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;99999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_trailing_repeat_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span><span class="s2">&quot;SV9(05)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;99999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>14.8.5. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>A Usage object is attached to a DDE to explain how to decode the bytes
that will be found in the record.  There are many cases in COBOL, but we only
really care about three: DISPLAY, COMP and COMP-3.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestUsageDisplay</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UsageDisplay</span><span class="p">(</span> <span class="s2">&quot;DISPLAY&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s2">&quot;99999&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;DISPLAY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>Note the sizing issue for COMP:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="81%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Picture Info</th>
<th class="head">Bytes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>if  1&lt;=(int+fract)&lt;=4</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>if  5&lt;=(int+fract)&lt;=9</td>
<td>4</td>
</tr>
<tr class="row-even"><td>if 10&lt;=(int+fract)&lt;=18</td>
<td>8</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestUsageComp</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UsageComp</span><span class="p">(</span> <span class="s2">&quot;COMP&quot;</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size_999</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s2">&quot;999&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;COMP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size_S9_4</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s2">&quot;9999&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;COMP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size_S9_5</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s2">&quot;99999&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;COMP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestUsageComp3</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UsageComp3</span><span class="p">(</span> <span class="s2">&quot;COMP-3&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s2">&quot;9999999&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="allocation">
<h2>14.8.6. Allocation<a class="headerlink" href="#allocation" title="Permalink to this headline">¶</a></h2>
<p>There are three kinds: group (i.e., a header under a group), successor,
and redefines.</p>
<p>A Redefines object gets the offset information from another named element.
A Group object
for an item.  A non-redefined element is “real”: it has a proper size and offset.</p>
<p>An item with a REDEFINES
clause is an alias for another element.   The offset comes from the other element.  The size is reported as zero to simplify offset calculations.</p>
<p>Here’s a Mock DDE which can have a redefines clause, or be referenced by
a redefines clause.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MockDDE</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># default</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kw</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">child</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">child</span> <span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
</pre></div>
</div>
<p>There are two non-redefinies cases: Successor and Group. The DDE stands for itself.  The size is
as computed.  The offset is as generated by the <a class="reference internal" href="../cobol_defs.html#cobol.defs.setSizeAndOffset" title="cobol.defs.setSizeAndOffset"><code class="xref py py-func docutils literal notranslate"><span class="pre">cobol.defs.setSizeAndOffset()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestAllocation_Group</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">123</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">123</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_get_size_and_offset</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">123</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">totalSize</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">dde</span><span class="p">()</span> <span class="p">)</span>

<span class="k">class</span> <span class="nc">TestAllocation_Successor</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">12</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">5</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successor</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">successor</span><span class="p">,</span> <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">7</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_get_size_and_offset</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successor</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">totalSize</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">dde</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>Redefines is a reference to another DDE. The other DDE is located by the resolver pass.
The size and offset come from the other element.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestAllocation_Rdefines</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span> <span class="s2">&quot;TOP&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">12</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">otherdde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span> <span class="s2">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">23</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">otherdde</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redefines_some_name</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">(</span> <span class="s2">&quot;SOME-NAME&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span> <span class="s2">&quot;REDEF&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">47</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redefines_some_name</span><span class="p">,</span> <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_get_size_and_offset</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Since this redefines something else, it doesn&#39;t contribute any size.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redefines_some_name</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">totalSize</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">dde</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="size-and-offset-function">
<h2>14.8.7. Size And Offset Function<a class="headerlink" href="#size-and-offset-function" title="Permalink to this headline">¶</a></h2>
<p>The idea is that this function does a depth-first traversal to accumulate the
size in each group-level DDE.</p>
<div class="section" id="size-and-offset-mocks">
<h3>14.8.7.1. Size and Offset Mocks<a class="headerlink" href="#size-and-offset-mocks" title="Permalink to this headline">¶</a></h3>
<p>To test size and offset function, we need a number of mocks.
We need to mock a DDE.   Plus,
we need to mock Usage and Redefines classes, also.</p>
<p>We also mock the iterable protocol of the DDE.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MockDDE2</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occurs</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span> <span class="s2">&quot;FILLER&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizeScalePrecision</span><span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality</span><span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kw</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">length</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">rc</span><span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="p">,</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">):</span>
            <span class="n">rc</span><span class="o">=</span> <span class="s2">&quot;REDEFINES </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="n">oc</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occurs</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2"> </span><span class="si">{3}</span><span class="s2"> </span><span class="si">{4}</span><span class="s2">.  </span><span class="si">{5}</span><span class="s2"> </span><span class="si">{6}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">oc</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>  <span class="p">)</span>
    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">child</span> <span class="p">):</span>
        <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">child</span> <span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">indent</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span> <span class="k">return</span> <span class="n">d</span>
    <span class="k">def</span> <span class="nf">pathTo</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c_i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">c_i</span>

<span class="k">class</span> <span class="nc">MockUsage</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">MockCell</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">workbook</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">=</span> <span class="n">buffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workbook</span><span class="o">=</span> <span class="n">workbook</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_</span><span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typeInfo</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kw</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="k">def</span> <span class="nf">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">picture</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typeInfo</span><span class="o">=</span> <span class="n">picture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">=</span> <span class="n">picture</span><span class="o">.</span><span class="n">length</span>
    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_</span>
    <span class="k">def</span> <span class="nf">create_func</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">workbook</span><span class="p">,</span> <span class="n">attr</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">MockUsage</span><span class="o">.</span><span class="n">MockCell</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">workbook</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">mock_resolver</span><span class="p">(</span> <span class="n">top</span> <span class="p">):</span>
    <span class="k">for</span> <span class="n">aDDE</span> <span class="ow">in</span> <span class="n">top</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">aDDE</span><span class="o">.</span><span class="n">allocation</span><span class="p">:</span>
            <span class="n">aDDE</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="n">aDDE</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Not setup by test.</span>
            <span class="c1">#aDDE.allocation= stingray.cobol.defs.Group()</span>
            <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="size-and-offset-cases">
<h3>14.8.7.2. Size and Offset Cases<a class="headerlink" href="#size-and-offset-cases" title="Permalink to this headline">¶</a></h3>
<p>Exercise the size and offset function with a number of cases.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestFlatSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestNestedSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">11</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">16</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">24</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestRedefinesSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP-1&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group_1</span> <span class="p">)</span>
        <span class="n">sub_group_2</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP-2&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">(</span><span class="n">refers_to</span><span class="o">=</span><span class="n">sub_group_1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP-1&quot;</span><span class="p">,),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group_2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestOccursSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99999&quot;</span><span class="p">,</span>
                <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">38</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestGroupOccursSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP-1&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group_1</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99999&quot;</span><span class="p">,</span>
                <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_be_repeatable</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="resolve-redefines">
<h2>14.8.8. Resolve Redefines<a class="headerlink" href="#resolve-redefines" title="Permalink to this headline">¶</a></h2>
<p>We need to test the <code class="xref py py-func docutils literal notranslate"><span class="pre">cobol.loader.resolver()</span></code> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestRedefinesNameResolver</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP-1&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP-2&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">(</span><span class="n">refers_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP-1&quot;</span><span class="p">,),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">search</span><span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;GROUP-1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="p">,</span>
            <span class="s1">&#39;GROUP-2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">test_should_resolve</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">refers_to</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="set-dimensionality">
<h2>14.8.9. Set Dimensionality<a class="headerlink" href="#set-dimensionality" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">stingray.cobol.defs.setDimensionality()</span></code> function pushes the OCCURS information down to each
child of the OCCURS. This builds the effective dimensionality of the lowest-level
elements.</p>
<div class="highlight-cobol notranslate"><div class="highlight"><pre><span></span><span class="c">* COPY</span><span class="mi">3</span><span class="p">.</span><span class="nv">COB</span>
<span class="c"> 01  S</span><span class="nv">URVEY-RESPONSES</span><span class="p">.</span>
<span class="c">     0</span><span class="mi">5  </span><span class="nv">QUESTION-NUMBER</span>         <span class="kp">OCCURS</span> <span class="mi">10 </span><span class="kp">TIMES</span><span class="p">.</span>
<span class="c">      </span>   <span class="mi">10  </span><span class="nv">RESPONSE-CATEGORY</span>     <span class="kp">OCCURS</span> <span class="mi">3 </span><span class="kp">TIMES</span><span class="p">.</span>
<span class="c">      </span>       <span class="mi">15  </span><span class="nv">ANSWER</span>                          <span class="kt">PIC 99</span><span class="p">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Test_Dimensionality</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SURVEY-RESPONSES&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span> <span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;QUESTION-NUMBER&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span> <span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;RESPONSE-CATEGORY&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span> <span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ANSWER&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99&quot;</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;99&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_dimensions</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setDimensionality</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="p">,),</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dde-construction-methods">
<h2>14.8.10. DDE Construction Methods<a class="headerlink" href="#dde-construction-methods" title="Permalink to this headline">¶</a></h2>
<p>DDE class has many methods.  They fit into three functionality categories.</p>
<ol class="arabic simple">
<li>Building the DDE, adding children, visiting.</li>
<li>Getting elements by simple name.  Computing path names.  Getting elements by path name.</li>
<li>Getting a run-time value from a buffer, accounting for indexes.  This
is DDE Access and is tested separately.</li>
</ol>
<p>The first two areas are tested here.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestDDEMethods</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">DDE</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;TOP&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">DDE</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">DDE</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ELEMENT&#39;</span><span class="p">,</span> <span class="n">pic</span><span class="o">=</span><span class="s1">&#39;X(5)&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_structure</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_path_name</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;TOP.GROUP.ELEMENT&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">pathTo</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">getPath</span><span class="p">(</span><span class="s2">&quot;TOP.GROUP.ELEMENT&quot;</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_get</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">g</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s2">&quot;GROUP&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">g</span> <span class="p">)</span>
        <span class="n">e</span><span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s2">&quot;ELEMENT&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">e</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-single-dde">
<h2>14.8.11. Parsing Single DDE<a class="headerlink" href="#parsing-single-dde" title="Permalink to this headline">¶</a></h2>
<p>The parser handles 11 different clauses.  Additionally, it makes a single
DDE element as well as making a composite DDE record.  A parser depends on
a lexical scanner.  However, since our scanner is essentially an iterator,
we don’t need to do very much to mock it.</p>
<p>To test just the <a class="reference internal" href="../cobol_loader.html#cobol.loader.RecordFactory" title="cobol.loader.RecordFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">cobol.loader.RecordFactory</span></code></a>
in isolation, we need to provide mocks for a large number of dependenices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">redefines_class</span><span class="o">=</span> <span class="n">Redefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">non_redefines_class</span><span class="o">=</span> <span class="n">NonRedefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">UsageDisplay</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">UsageComp</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">UsageComp3</span>
</pre></div>
</div>
<p>Note that there are numerous syntax errors which we do not test for.
Ideally, a DDE clause is used in working software, and passes through a COBOL compiler.  This isn’t <em>lint for COBOL</em>.</p>
<p>We have three test cases: things the parser finds (and keeps), things
the parser skips gracefully, and things we can’t cope with.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestParser</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
        <span class="c1">#self.parser.redefines_class= MockRedefines</span>
        <span class="c1">#self.parser.non_redefines_class= MockNonRedefine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">MockUsage</span>
    <span class="k">def</span> <span class="nf">test_should_parse_group</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">source</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="s2">&quot;GROUP&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_filler</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">source</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;FILLER&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_name</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">source</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;ELEMENTARY&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;ELEMENTARY&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_occurs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;ELEMENTARY-OCCURS&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;S9999&quot;</span><span class="p">,</span> <span class="s2">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;ELEMENTARY-OCCURS&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;S9999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;GROUP-OCCURS&quot;</span><span class="p">,</span> <span class="s2">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s2">&quot;INDEXED&quot;</span><span class="p">,</span> <span class="s2">&quot;BY&quot;</span><span class="p">,</span> <span class="s2">&quot;IRRELEVANT&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;GROUP-OCCURS&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_picture</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Details of picture clause tested separately.&quot;&quot;&quot;</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;ELEMENTARY-PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;S9999.999&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;ELEMENTARY-PIC&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;S9999.999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_redefines</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;ELEMENTARY-REDEF&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;S9999&quot;</span><span class="p">,</span> <span class="s2">&quot;REDEFINES&quot;</span><span class="p">,</span> <span class="s2">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;ELEMENTARY-REDEF&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;S9999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;GROUP-REDEF&quot;</span><span class="p">,</span> <span class="s2">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s2">&quot;REDEFINES&quot;</span><span class="p">,</span> <span class="s2">&quot;ANOTHER-NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;GROUP-REDEF&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;ANOTHER-NAME&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_usage</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;USE-DISPLAY&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;S9999&quot;</span><span class="p">,</span> <span class="s2">&quot;USAGE&quot;</span><span class="p">,</span> <span class="s2">&quot;DISPLAY&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;USE-DISPLAY&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;S9999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;DISPLAY&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;USE-COMP-3&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;S9(7)V99&quot;</span><span class="p">,</span> <span class="s2">&quot;USAGE&quot;</span><span class="p">,</span> <span class="s2">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;USE-COMP-3&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;S9(7)V99&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src3</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;USE-COMP-3-ALT&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;S9(9)V99&quot;</span><span class="p">,</span> <span class="s2">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src3</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;USE-COMP-3-ALT&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;S9(9)V99&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_depending_on_1</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;DEP-1&quot;</span><span class="p">,</span> <span class="s2">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;TO&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s2">&quot;DEPENDING&quot;</span><span class="p">,</span> <span class="s2">&quot;ON&quot;</span><span class="p">,</span> <span class="s2">&quot;ODO-1&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;DEP-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;ODO-1&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span> <span class="c1"># number(None) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_depending_on_2</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;DEP-2&quot;</span><span class="p">,</span> <span class="s2">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s2">&quot;TO&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s2">&quot;DEPENDING&quot;</span><span class="p">,</span> <span class="s2">&quot;ON&quot;</span><span class="p">,</span> <span class="s2">&quot;ODO-2&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;DEP-2&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;ODO-2&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span> <span class="c1"># number(None) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
</pre></div>
</div>
<p>Syntax which is silently skipped.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestParserSkip</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">test_should_skip_blank</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK-ZERO-1&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK&quot;</span><span class="p">,</span> <span class="s2">&quot;ZERO&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;BLANK-ZERO-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK-ZERO-2&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK&quot;</span><span class="p">,</span> <span class="s2">&quot;WHEN&quot;</span><span class="p">,</span> <span class="s2">&quot;ZEROES&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;BLANK-ZERO-2&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_skip_justified</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;JUST-RIGHT-1&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;JUST&quot;</span><span class="p">,</span> <span class="s2">&quot;RIGHT&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;JUST-RIGHT-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;JUST-RIGHT-2&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;JUSTIFIED&quot;</span><span class="p">,</span> <span class="s2">&quot;RIGHT&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;JUST-RIGHT-2&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_skip_value</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE-1&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(8)&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;10 CHARS&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s1">&#39;VALUE-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(8)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Test EXTERNAL, GLOBAL as Skipped Words, too.</p>
</div>
<p>A few clauses may be relevant for some kinds of DDE’s.  These
can impact the encoding of the bytes.  We don’t parse
them, however, because they are rarely seen in the wild.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestParserException</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">test_should_fail_renames</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;66&quot;</span><span class="p">,</span> <span class="s2">&quot;BLANK-ZERO-1&quot;</span><span class="p">,</span> <span class="s2">&quot;RENAMES&quot;</span><span class="p">,</span> <span class="s2">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">))</span> <span class="p">)</span>
        <span class="c1"># Alternative RENAMES</span>
        <span class="c1"># self.assertRaises( stingray.cobol.defs.UnsupportedError, ...</span>
    <span class="k">def</span> <span class="nf">test_should_fail_sign</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;SIGN-1&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;LEADING&quot;</span><span class="p">,</span> <span class="s2">&quot;SIGN&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;SIGN-2&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;TRAILING&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">src3</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;SIGN-3&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;SIGN&quot;</span><span class="p">,</span> <span class="s2">&quot;IS&quot;</span><span class="p">,</span> <span class="s2">&quot;SEPARATE&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src3</span><span class="p">))</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_fail_synchronized</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;SYNC-1&quot;</span><span class="p">,</span> <span class="s2">&quot;PIC&quot;</span><span class="p">,</span> <span class="s2">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s2">&quot;SYNCHRONIZED&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">))</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-complete-dde">
<h2>14.8.12. Parsing Complete DDE<a class="headerlink" href="#parsing-complete-dde" title="Permalink to this headline">¶</a></h2>
<p>Parsing a complete DDE is a multi-step dance.  First, parse all the clauses.
Then apply some standard functions to resolve the REDEFINES clauses
as well as compute sizes and offsets.</p>
<p>To test just the <a class="reference internal" href="../cobol_loader.html#cobol.loader.RecordFactory" title="cobol.loader.RecordFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">cobol.loader.RecordFactory</span></code></a>
in isolation, we need to provide mocks for a large number of dependenices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Built during the parsing</span>
<span class="bp">self</span><span class="o">.</span><span class="n">redefines_class</span><span class="o">=</span> <span class="n">Redefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">non_redefines_class</span><span class="o">=</span> <span class="n">NonRedefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">UsageDisplay</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">UsageComp</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">UsageComp3</span>
</pre></div>
</div>
<p>We use dependency injection here to tease apart Redefines and Usage classes.
We can use existing mocks for this.</p>
<p>Here’s a test of the “main” method for parsing a record.
Note that <code class="xref py py-meth docutils literal notranslate"><span class="pre">stingray.cobol.loader.RecordFactory.makeRecord()</span></code> is
iterable, so we make a list and take the first element.</p>
<p>We could as easily  <code class="docutils literal notranslate"><span class="pre">next()</span></code> it to get the first element.</p>
<p>Test the parser</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestCompleteParser</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">MockUsage</span>
    <span class="k">def</span> <span class="nf">test_should_parse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy1</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">              * COPY1.COB</span>
<span class="s2">               01  DETAIL-LINE.</span>
<span class="s2">                   05                              PIC X(7).</span>
<span class="s2">                   05  QUESTION                    PIC ZZ.</span>
<span class="s2">                   05                              PIC X(6).</span>
<span class="s2">                   05  PRINT-YES                   PIC ZZ.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;DETAIL-LINE&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(7)&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;QUESTION&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;X(6)&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;PRINT-YES&#39;</span><span class="p">,</span> <span class="s1">&#39;PIC&#39;</span><span class="p">,</span> <span class="s1">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">makeRecord</span><span class="p">(</span> <span class="nb">iter</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lex</span> <span class="p">)</span> <span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;DETAIL-LINE&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">c0</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;FILLER&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(7)&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">c1</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;QUESTION&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;ZZ&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">c2</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;FILLER&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;X(6)&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">c3</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;PRINT-YES&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;ZZ&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dde</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="schema-maker">
<h2>14.8.13. Schema Maker<a class="headerlink" href="#schema-maker" title="Permalink to this headline">¶</a></h2>
<p>A DDE is tranformed into a flat schema from the highly-nested DDE structure
via the <code class="xref py py-func docutils literal notranslate"><span class="pre">stingray.cobol.loader.make_schema()</span></code> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestNestedSchemaMaker</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;TOP&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;FIRST&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SECOND&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;99999&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">3</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GROUP&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;INNER&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;9999999&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXXXXXX&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;LAST&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">11</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s2">&quot;XXXXXXXXXXX&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">24</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">make_schema</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1">#DEBUG# print( schema )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;TOP&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;FIRST&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;SECOND&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s2">&quot;LAST&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">6</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">24</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="another-variation-on-loading-dde-s">
<h2>14.8.14. Another Variation on Loading DDE’s<a class="headerlink" href="#another-variation-on-loading-dde-s" title="Permalink to this headline">¶</a></h2>
<p>Here’s a class which does some loading. The processing is a bit convoluted,
but this is a possible use case, and must work.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SchemaLoaderClass</span> <span class="p">(</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">COBOLSchemaLoader</span><span class="p">):</span>
    <span class="n">lexer_class</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer_Long_Lines</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">fixed_dde_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">unused_dde_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">dde_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">makeRecord</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">hdr_trl_record_copybook</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">000010 01  HEADER-TRAILER-RECORD.</span>
<span class="s2">000020            05  HDR-REC-TYPE                        PIC X(6).</span>
<span class="s2">000030            05  FILLER                              PIC X(5).</span>
<span class="s2">000040            05  HDR-TRL                             PIC X(8).</span>
<span class="s2">000050            05  FILLER                              PIC X(1).</span>
<span class="s2">000060            05  HDR-DATE1                           PIC X(10).</span>
<span class="s2">000070            05  FILLER                              PIC X(1).</span>
<span class="s2">000080            05  HDR-JULIAN-DATE1                    PIC X(7).</span>
<span class="s2">000090            05  FILLER                              PIC X(1).</span>
<span class="s2">000100            05  HDR-SOME-NUMBER1                    PIC X(8).</span>
<span class="s2">000110            05  FILLER                              PIC X(1).</span>
<span class="s2">000120            05  HDR-DATE2                           PIC X(10).</span>
<span class="s2">000130            05  FILLER                              PIC X(1).</span>
<span class="s2">000140            05  HDR-SOME-NUMBER2                    PIC X(7).</span>
<span class="s2">000150            05  FILLER                              PIC X(1).</span>
<span class="s2">000140            05  HDR-SOME-NUMBER3                    PIC X(4).</span>
<span class="s2">000160            05  HDR-REST-OF-LINE            PIC X(30).</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">dde_list</span><span class="o">+=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">makeRecord</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">hdr_trl_record_copybook</span><span class="p">)</span> <span class="p">))</span>
        <span class="k">for</span> <span class="n">dde</span> <span class="ow">in</span> <span class="n">dde_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span><span class="s1">&#39;HEADER-TRAILER-RECORD&#39;</span><span class="p">:</span>
                <span class="n">fixed_dde_list</span><span class="o">+=</span> <span class="p">[</span><span class="n">dde</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ANOTHER-RECORD&#39;</span><span class="p">:</span>
                <span class="n">base_dde</span><span class="o">=</span> <span class="p">[</span><span class="n">dde</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unused_dde_list</span><span class="o">+=</span> <span class="p">[</span><span class="n">dde</span><span class="p">]</span>
        <span class="n">schema</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">make_schema</span><span class="p">(</span> <span class="n">base_dde</span> <span class="p">)</span>
        <span class="n">fixed_schema</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">make_schema</span><span class="p">(</span> <span class="n">fixed_dde_list</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">schema</span><span class="p">,</span> <span class="n">fixed_schema</span>
</pre></div>
</div>
<p>Confirm that this class really works</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestSchemaLoaderClass</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_should_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">another_record</span> <span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">      01  ANOTHER-RECORD.</span>
<span class="s2">          05  FILLER PIC X(10).</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">example</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">another_record</span><span class="p">)</span>
        <span class="n">slc</span><span class="o">=</span> <span class="n">SchemaLoaderClass</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
        <span class="n">schema</span><span class="p">,</span> <span class="n">fixed_schema</span><span class="o">=</span> <span class="n">slc</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="nb">any</span><span class="p">(</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ANOTHER-RECORD&quot;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">schema</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="nb">any</span><span class="p">(</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;HEADER-TRAILER-RECORD&quot;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fixed_schema</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="test-suite-and-runner">
<h2>14.8.15. Test Suite and Runner<a class="headerlink" href="#test-suite-and-runner" title="Permalink to this headline">¶</a></h2>
<p>In case we want to build up a larger test suite, we avoid doing
any real work unless this is the main module being executed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">test</span>
<span class="n">suite</span><span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">suite_maker</span><span class="p">(</span> <span class="nb">globals</span><span class="p">()</span> <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="vm">__file__</span> <span class="p">)</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/Stingray_belon1553_small.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Stingray Schema-Based File Reader, stingray</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">2. Design Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../package.html">3. The <code class="docutils literal notranslate"><span class="pre">stingray</span></code> Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cell.html">4. Cell Module – Data Element Containers and Conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sheet.html">5. Sheet Module – Sheet and Row Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schema.html">6. Schema Package – Schema and Attribute Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schema_loader.html">7. Schema Loader Module – Load Embedded or External Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workbook/index.html">8. Workbook Package – Uniform Wrappers for Workbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iwork13.html">9. The “Other” Modules: snappy and protobuf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cobol.html">10. The COBOL Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">11. The <strong>Stingray</strong> Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/index.html">12. <strong>Stingray</strong> Demo Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">13. History</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">14. Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build.html">15. Stingray Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">16. Installation via <code class="docutils literal notranslate"><span class="pre">setup.py</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">17. Licensing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">14. Testing</a><ul>
      <li>Previous: <a href="cobol.html" title="previous chapter">14.7. COBOL Schema Testing</a></li>
      <li>Next: <a href="cobol_2.html" title="next chapter">14.9. COBOL Integration Tests</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2013, S. Lott.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/testing/cobol_loader.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>